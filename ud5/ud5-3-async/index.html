
<!doctype html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../ud5-2-components/">
      
      
        <link rel="next" href="../../ud6/ud6-1-angular-intro/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.9">
    
    
      
        <title>UD5 - 3. Comunicación asíncrona - Desarrollo Web en Entorno Cliente</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.f2e4d321.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/bs5_layout.css">
    
      <link rel="stylesheet" href="../../stylesheets/custom.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#ud5-3-comunicacion-asincrona" class="md-skip">
          Saltar a contenido
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Cabecera">
    <a href="../.." title="Desarrollo Web en Entorno Cliente" class="md-header__button md-logo" aria-label="Desarrollo Web en Entorno Cliente" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Desarrollo Web en Entorno Cliente
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              UD5 - 3. Comunicación asíncrona
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple"  aria-label="Cambiar a modo oscuro"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Cambiar a modo oscuro" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="lime"  aria-label="Cambiar a modo claro"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Cambiar a modo claro" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Pestañas" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../.." class="md-tabs__link">
          
  
  Inicio

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../proyectos/pr1-clave-secreta/" class="md-tabs__link">
          
  
  Proyectos

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../ud1/ud1-1-tecnologias/" class="md-tabs__link">
          
  
  UD1 Sintaxis

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../ud2/ud2-1-DOM/" class="md-tabs__link">
          
  
  UD2 DOM

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../ud3/ud3-1-eventos/" class="md-tabs__link">
          
  
  UD3 Eventos y formularios

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../ud4/ud4-1-oop/" class="md-tabs__link">
          
  
  UD4 POO

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../ud5-1-native-libraries/" class="md-tabs__link">
          
  
  UD5 Librerías

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../ud6/ud6-1-angular-intro/" class="md-tabs__link">
          
  
  UD6 Angular

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navegación" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Desarrollo Web en Entorno Cliente" class="md-nav__button md-logo" aria-label="Desarrollo Web en Entorno Cliente" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Desarrollo Web en Entorno Cliente
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Inicio
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            Inicio
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Desarrollo Web en Entorno Cliente
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../entorno/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Entorno de trabajo
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Proyectos
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Proyectos
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../proyectos/pr1-clave-secreta/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Proyecto 1 - Clave Secreta
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../proyectos/pr2-todo-list/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Proyecto 2 - To Do List
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../proyectos/pr3-restaurante/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    None
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    UD1 Sintaxis
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            UD1 Sintaxis
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud1/ud1-1-tecnologias/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UD1 - 1. Arquitecturas y tecnologías de programación
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud1/ud1-2-sintaxis/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UD1 - 2. Manejo de la sintaxis del lenguaje
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud1/ud1-2-1-objetos/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UD1 - 2.1. Objetos en Javascript
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud1/ud1-2-2-arrays/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UD1 - 2.2. Arrays
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud1/ud1-2-3-programacion-funcional/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UD1 - 2.3. Programación funcional
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../refuerzo/ud1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ejercicios de refuerzo UD1
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    UD2 DOM
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            UD2 DOM
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud2/ud2-1-DOM/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UD2 - 1. Objetos predefinidos del lenguaje (DOM)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud2/ud2-2-BOM/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UD2 - 2. Browser Object Model (BOM)
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    UD3 Eventos y formularios
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            UD3 Eventos y formularios
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud3/ud3-1-eventos/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UD3 - 1. Eventos
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud3/ud3-2-formularios/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UD3 - 2. Validación de formularios
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud3/ud3-proyecto-clave-secreta.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    None
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    UD4 POO
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            UD4 POO
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud4/ud4-1-oop/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UD4 - 1. Programación orientada a Objetos en Javascript
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud4/ud4-2-estructura/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UD4 - 2. Estructuración de proyectos
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud4/ud4-3-mvc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UD3 - 3. El patrón Modelo-Vista-Controlador (MVC)
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" checked>
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="">
            
  
  <span class="md-ellipsis">
    UD5 Librerías
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            UD5 Librerías
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ud5-1-native-libraries/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UD5 - 1. Objetos predefinidos
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ud5-2-components/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UD5 - 2. Componentes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    UD5 - 3. Comunicación asíncrona
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    UD5 - 3. Comunicación asíncrona
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Tabla de contenidos">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tabla de contenidos
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#promesas" class="md-nav__link">
    <span class="md-ellipsis">
      Promesas
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Promesas">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#consumir-promesas" class="md-nav__link">
    <span class="md-ellipsis">
      Consumir promesas
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#codigo-asincrono" class="md-nav__link">
    <span class="md-ellipsis">
      Código asíncrono
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#crear-promesas" class="md-nav__link">
    <span class="md-ellipsis">
      Crear promesas
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#async-await" class="md-nav__link">
    <span class="md-ellipsis">
      Async / Await
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Async / Await">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#await" class="md-nav__link">
    <span class="md-ellipsis">
      Await
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async" class="md-nav__link">
    <span class="md-ellipsis">
      Async
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#awaitasync-then" class="md-nav__link">
    <span class="md-ellipsis">
      Await/Async + .then()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asincronia-en-asyncawait" class="md-nav__link">
    <span class="md-ellipsis">
      Asincronía en async/await
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#peticiones-ajax" class="md-nav__link">
    <span class="md-ellipsis">
      Peticiones Ajax
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Peticiones Ajax">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#metodos-http" class="md-nav__link">
    <span class="md-ellipsis">
      Métodos HTTP
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#api-fetch" class="md-nav__link">
    <span class="md-ellipsis">
      API Fetch
    </span>
  </a>
  
    <nav class="md-nav" aria-label="API Fetch">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#peticiones-con-async-await" class="md-nav__link">
    <span class="md-ellipsis">
      Peticiones con async / await
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diferencia-entre-asyncawait-y-promesas" class="md-nav__link">
    <span class="md-ellipsis">
      Diferencia entre async/await y promesas
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hacer-varias-peticiones-simultaneamente-promiseall" class="md-nav__link">
    <span class="md-ellipsis">
      Hacer varias peticiones simultáneamente. Promise.all()
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#realizar-peticiones-ajax" class="md-nav__link">
    <span class="md-ellipsis">
      Realizar peticiones Ajax
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Realizar peticiones Ajax">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#json-server" class="md-nav__link">
    <span class="md-ellipsis">
      Json Server
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rest-client" class="md-nav__link">
    <span class="md-ellipsis">
      REST client
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ejemplos-de-envio-de-datos" class="md-nav__link">
    <span class="md-ellipsis">
      Ejemplos de envío de datos
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#single-page-application" class="md-nav__link">
    <span class="md-ellipsis">
      Single Page Application
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#resumen-de-llamadas-asincronas" class="md-nav__link">
    <span class="md-ellipsis">
      Resumen de llamadas asíncronas
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cors" class="md-nav__link">
    <span class="md-ellipsis">
      CORS
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    UD6 Angular
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            UD6 Angular
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud6/ud6-1-angular-intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UD6 - 1. Introducción a Angular
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud6/ud6-2-angular-databinding/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UD6 - 2. Data binding. Pipes.
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud6/ud6-3-angular-services/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UD6 - 3. Componentes anidados. Servicios
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud6/ud6-4-angular-rest/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UD6 - 4. HttpClient
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud6/ud6-5-angular-routing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UD6 - 5. Routing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud6/ud6-6-angular-template-forms/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UD6 - 6. Formularios de plantilla
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud6/ud6-7-angular-i18n/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UD6 - 7. Internacionalización
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_8" >
        
          
          <label class="md-nav__link" for="__nav_8_8" id="__nav_8_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Actividades
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_8">
            <span class="md-nav__icon md-icon"></span>
            Actividades
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud6/actividades/ud6-act1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UD 6 - Actividad 1
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud6/actividades/ud6-act2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UD 6 - Actividad 2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud6/actividades/ud6-act3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UD 6 - Actividad 3
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud6/actividades/ud6-act4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UD 6 - Actividad 4
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud6/actividades/ud6-act5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UD 6 - Actividad 5
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_9" >
        
          
          <label class="md-nav__link" for="__nav_8_9" id="__nav_8_9_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Proyecto
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_9">
            <span class="md-nav__icon md-icon"></span>
            Proyecto
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../proyectos/pr3-restaurante/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Proyecto 2º EV - Gestión carta de un restaurante
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_10" >
        
          
          <label class="md-nav__link" for="__nav_8_10" id="__nav_8_10_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Repositorios de ejemplo
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_10">
            <span class="md-nav__icon md-icon"></span>
            Repositorios de ejemplo
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/jsanvil/angular-products" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    angular-products
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/jsanvil/angular-products-material" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    angular-products-material
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Tabla de contenidos">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tabla de contenidos
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#promesas" class="md-nav__link">
    <span class="md-ellipsis">
      Promesas
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Promesas">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#consumir-promesas" class="md-nav__link">
    <span class="md-ellipsis">
      Consumir promesas
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#codigo-asincrono" class="md-nav__link">
    <span class="md-ellipsis">
      Código asíncrono
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#crear-promesas" class="md-nav__link">
    <span class="md-ellipsis">
      Crear promesas
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#async-await" class="md-nav__link">
    <span class="md-ellipsis">
      Async / Await
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Async / Await">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#await" class="md-nav__link">
    <span class="md-ellipsis">
      Await
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async" class="md-nav__link">
    <span class="md-ellipsis">
      Async
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#awaitasync-then" class="md-nav__link">
    <span class="md-ellipsis">
      Await/Async + .then()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asincronia-en-asyncawait" class="md-nav__link">
    <span class="md-ellipsis">
      Asincronía en async/await
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#peticiones-ajax" class="md-nav__link">
    <span class="md-ellipsis">
      Peticiones Ajax
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Peticiones Ajax">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#metodos-http" class="md-nav__link">
    <span class="md-ellipsis">
      Métodos HTTP
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#api-fetch" class="md-nav__link">
    <span class="md-ellipsis">
      API Fetch
    </span>
  </a>
  
    <nav class="md-nav" aria-label="API Fetch">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#peticiones-con-async-await" class="md-nav__link">
    <span class="md-ellipsis">
      Peticiones con async / await
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diferencia-entre-asyncawait-y-promesas" class="md-nav__link">
    <span class="md-ellipsis">
      Diferencia entre async/await y promesas
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hacer-varias-peticiones-simultaneamente-promiseall" class="md-nav__link">
    <span class="md-ellipsis">
      Hacer varias peticiones simultáneamente. Promise.all()
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#realizar-peticiones-ajax" class="md-nav__link">
    <span class="md-ellipsis">
      Realizar peticiones Ajax
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Realizar peticiones Ajax">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#json-server" class="md-nav__link">
    <span class="md-ellipsis">
      Json Server
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rest-client" class="md-nav__link">
    <span class="md-ellipsis">
      REST client
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ejemplos-de-envio-de-datos" class="md-nav__link">
    <span class="md-ellipsis">
      Ejemplos de envío de datos
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#single-page-application" class="md-nav__link">
    <span class="md-ellipsis">
      Single Page Application
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#resumen-de-llamadas-asincronas" class="md-nav__link">
    <span class="md-ellipsis">
      Resumen de llamadas asíncronas
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cors" class="md-nav__link">
    <span class="md-ellipsis">
      CORS
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="ud5-3-comunicacion-asincrona">UD5 - 3. Comunicación asíncrona<a class="headerlink" href="#ud5-3-comunicacion-asincrona" title="Permanent link">&para;</a></h1>
<h2 id="promesas">Promesas<a class="headerlink" href="#promesas" title="Permanent link">&para;</a></h2>
<p>Las promesas son un concepto para resolver el problema de asincronía de una forma mucho más elegante y práctica que, por ejemplo, utilizando funciones <em>callback</em> directamente.</p>
<p>Las promesas pueden tener varios estados:</p>
<ul>
<li>Resuelta. La promesa se cumple</li>
<li>Rechazada. La promesa no se cumple</li>
<li>Pendiente. La promesa se queda en un estado incierto indefinidamente</li>
</ul>
<p>Con estas sencillas bases, podemos entender el funcionamiento de una promesa en Javascript. Antes de empezar, también debemos tener claro que existen dos partes importantes de las promesas:</p>
<ul>
<li>Consumirlas</li>
<li>Crearlas, preparar una función para que use promesas y se puedan consumir.</li>
</ul>
<p>Las promesas en <em>Javascript</em> se representan a través de un objeto, y cada promesa estará en un estado concreto: pendiente, resuelta o rechazada. Además, cada promesa tiene los siguientes métodos, que podremos utilizar para utilizarla:</p>
<ul>
<li><strong><code>.then(resolve)</code></strong>: ejecuta la función <em>callback</em> <code>resolve</code> cuando la promesa se cumple.</li>
<li><strong><code>.catch(reject)</code></strong>: ejecuta la función <em>callback</em> <code>reject</code> cuando la promesa se rechaza.</li>
<li><strong><code>.then(resolve, reject)</code></strong>: Método equivalente a los dos anteriores contenido en un solo método.</li>
<li><strong><code>.finally()</code></strong>: ejecuta la función <em>callback</em> <code>finally</code> cuando la promesa se cumple o si se rechaza.</li>
</ul>
<h3 id="consumir-promesas">Consumir promesas<a class="headerlink" href="#consumir-promesas" title="Permanent link">&para;</a></h3>
<p>La forma general de consumir una promesa es utilizando el <code>.then()</code> con un sólo parámetro, puesto que muchas veces lo único que nos interesa es realizar una acción cuando la promesa se cumpla:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nx">fetch</span><span class="p">(</span><span class="s2">&quot;/datos.json&quot;</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="w">  </span><span class="cm">/* Código a realizar cuando se cumpla la promesa */</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="p">});</span>
</code></pre></div>
<p>Lo que vemos en el ejemplo anterior es el uso de la función <code>fetch()</code>, la cuál devuelve una promesa que se cumple cuando obtiene respuesta de la petición realizada. De esta forma, estaríamos preparando (de una forma legible) la forma de actuar de nuestro código a la respuesta de la petición realizada, todo ello de forma asíncrona.</p>
<p>Recuerda que podemos hacer uso del método <code>.catch()</code> para actuar cuando se rechaza una promesa:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="nx">fetch</span><span class="p">(</span><span class="s2">&quot;/datos.json&quot;</span><span class="p">)</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="w">  </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="w">    </span><span class="cm">/* Código a realizar cuando se cumpla la promesa */</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="w">  </span><span class="p">})</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="w">  </span><span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="w">    </span><span class="cm">/* Código a realizar cuando se rechaza la promesa */</span>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="w">  </span><span class="p">});</span>
</code></pre></div>
<p>Observa como hemos indentado los métodos <code>.then()</code> y <code>.catch()</code>, ya que se suele hacer así para que sea mucho más legible. Además, se pueden encadenar varios <code>.then()</code> si se siguen generando promesas y se devuelven con un return:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="nx">fetch</span><span class="p">(</span><span class="s2">&quot;/datos.json&quot;</span><span class="p">)</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="w">  </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">response</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">text</span><span class="p">();</span><span class="w"> </span><span class="c1">// Devuelve una promesa</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="w">  </span><span class="p">})</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="w">  </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">data</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="w">  </span><span class="p">})</span>
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="w">  </span><span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">error</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* Código a realizar cuando se rechaza la promesa */</span><span class="w"> </span><span class="p">});</span>
</code></pre></div>
<p>Usando arrow functions se puede mejorar aún más la legibilidad de este código, recordando que cuando sólo tenemos una sentencia en el cuerpo de la arrow function hay un return implícito:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="nx">fetch</span><span class="p">(</span><span class="s2">&quot;/datos.json&quot;</span><span class="p">)</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="w">  </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">response</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">text</span><span class="p">())</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="w">  </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">data</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">))</span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="w">  </span><span class="p">.</span><span class="k">finally</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Terminado.&quot;</span><span class="p">))</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="w">  </span><span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">error</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">data</span><span class="p">));</span>
</code></pre></div>
<p>Se añade el método .finally() para añadir una función <em>callback</em> que se ejecutará tanto si la promesa se cumple o se rechaza, lo que nos ahorrará tener que repetir la función en el <code>.then()</code> como en el <code>.catch()</code>.</p>
<h3 id="codigo-asincrono">Código asíncrono<a class="headerlink" href="#codigo-asincrono" title="Permanent link">&para;</a></h3>
<p>Algo muy importante, pero que quizás hemos pasado por alto es que el código que ejecutamos en el interior de un <code>.then()</code> es código asíncrono no bloqueante:</p>
<ul>
<li><strong>Asíncrono</strong>: Porque no se ejecuterá de inmediato, sino que tardará en ejecutarse.</li>
<li><strong>No bloqueante</strong>: Porque mientras espera ser ejecutado, no bloquea el resto del programa.</li>
</ul>
<p>Cuando llegamos a un <code>.then()</code>, el sistema no se bloquea, sino que deja la función «pendiente» hasta que se cumpla la promesa, pero mientras, continua procesando el resto del programa.</p>
<p>Observa el siguiente ejemplo:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="nx">fetch</span><span class="p">(</span><span class="s2">&quot;/datos.json&quot;</span><span class="p">)</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="w">  </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">response</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">text</span><span class="p">())</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="w">  </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">data</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Código asíncrono&quot;</span><span class="p">);</span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="w">  </span><span class="p">});</span>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Código síncrono&quot;</span><span class="p">)</span>
</code></pre></div>
<p>Aunque el <code>console.log("Código asíncrono")</code> figure unas líneas antes del <code>console.log("Código síncrono")</code>, se mostrará más tarde. Esto ocurre porque el <code>console.log()</code> del interior del <code>.then()</code> no ocurre inmediatamente, y al no ser bloqueante, se continua con el resto del programa hasta que se ejecute, que lo retomará.</p>
<h3 id="crear-promesas">Crear promesas<a class="headerlink" href="#crear-promesas" title="Permanent link">&para;</a></h3>
<p>Para crear una promesa se utiliza el objeto <code>Promise</code>, de la siguiente forma <code>new Promise((resolve, reject) =&gt; { })</code> se le pasa por parámetro una función anónima con dos parámetros de <em>callback</em>:</p>
<ul>
<li><strong><code>resolve</code></strong>. Lo utilizaremos cuando se cumpla la promesa.</li>
<li><strong><code>reject</code></strong>. Lo utilizaremos cuando se rechace la promesa.</li>
</ul>
<p>Ejemplo de creación de una promesa:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="c1">// Ejemplo sencillo donde se va llenando un array con números aleatorios</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="c1">// se aparece un 6 se rechaza la promesa</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">doTask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">iterations</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span><span class="w"> </span><span class="nx">reject</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">numbers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">let</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">iterations</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">6</span><span class="p">);</span>
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a><span class="w">        </span><span class="nx">numbers</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">number</span><span class="p">);</span>
<a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">number</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">6</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a><span class="w">          </span><span class="nx">reject</span><span class="p">({</span>
<a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a><span class="w">            </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a><span class="w">            </span><span class="nx">message</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Se ha sacado un 6&quot;</span>
<a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a><span class="w">          </span><span class="p">});</span>
<a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a><span class="w">      </span><span class="p">}</span>
<a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a>
<a id="__codelineno-5-18" name="__codelineno-5-18" href="#__codelineno-5-18"></a><span class="w">      </span><span class="nx">resolve</span><span class="p">({</span>
<a id="__codelineno-5-19" name="__codelineno-5-19" href="#__codelineno-5-19"></a><span class="w">        </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<a id="__codelineno-5-20" name="__codelineno-5-20" href="#__codelineno-5-20"></a><span class="w">        </span><span class="nx">value</span><span class="o">:</span><span class="w"> </span><span class="nx">numbers</span>
<a id="__codelineno-5-21" name="__codelineno-5-21" href="#__codelineno-5-21"></a><span class="w">      </span><span class="p">});</span>
<a id="__codelineno-5-22" name="__codelineno-5-22" href="#__codelineno-5-22"></a><span class="w">    </span><span class="p">});</span><span class="w">  </span><span class="c1">// new Promise</span>
<a id="__codelineno-5-23" name="__codelineno-5-23" href="#__codelineno-5-23"></a><span class="w">  </span><span class="p">};</span><span class="w"> </span><span class="c1">// doTask</span>
</code></pre></div>
<p>Como ves, se trata de una implementación muy similar a los callbacks que vimos en el apartado anterior, pero observa que se devuelve una  que envuelve toda la función, permitiendo así consumirla cómodamente más tarde:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="nx">doTask</span><span class="p">(</span><span class="mf">10</span><span class="p">)</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="w">  </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">result</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Tiradas correctas: &quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">result</span><span class="p">.</span><span class="nx">value</span><span class="p">))</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="w">  </span><span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">err</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;Ha ocurrido algo: &quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="p">));</span>
</code></pre></div>
<p>Imagina el caso de que cada lanzamiento del dado (la parte donde genera el número aleatorio) fuera un proceso más costoso que tardara un tiempo considerable, quizás de esa forma se vea más clara la necesidad de una tarea asíncrona, controlada con promesas.</p>
<h2 id="async-await">Async / Await<a class="headerlink" href="#async-await" title="Permanent link">&para;</a></h2>
<p>En <em>ES2017</em> se introducen las palabras clave <code>async</code>/<code>await</code>, que no son más que una forma para gestionar las promesas. </p>
<p>Con <code>async</code>/<code>await</code> seguimos manejando promesas, sin embargo, hay ciertos cambios importantes:</p>
<ul>
<li>El código se vuelve más legible, ya que se parece más a código síncrono.</li>
<li>Se puede utilizar <code>try</code>/<code>catch</code> para gestionar los errores de una forma más cómoda.</li>
<li>Se puede utilizar <code>await</code> para esperar a que se cumpla una promesa, y así evitar el uso de <code>.then()</code>.</li>
</ul>
<h3 id="await">Await<a class="headerlink" href="#await" title="Permanent link">&para;</a></h3>
<p>La palabra clave <code>await</code> se utiliza para esperar a que se cumpla una promesa, y así evitar el uso de <code>.then()</code>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="s2">&quot;datos.txt&quot;</span><span class="p">);</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="kd">const</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">text</span><span class="p">();</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Código síncrono.&quot;</span><span class="p">);</span>
</code></pre></div>
<p>Lo que hace <code>await</code> es detener la ejecución y no continuar. Se espera a que se resuelva la promesa, y hasta que no lo haga, no continua. A diferencia del <code>fetch()</code>, tenemos un código bloqueante.</p>
<p>Lo normal es que se utilice <code>await</code> dentro de una función. Por ejemplo:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="kd">function</span><span class="w"> </span><span class="nx">request</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="s2">&quot;datos.txt&quot;</span><span class="p">);</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">text</span><span class="p">();</span>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">data</span><span class="p">;</span>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="p">}</span>
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="nx">request</span><span class="p">();</span>
</code></pre></div>
<p>Sin embargo, aquí tenemos un problema. Estamos utilizando <code>await</code> (asíncrono) dentro de <code>request()</code> (síncrono), por lo que antes de ejecutarla, al intentarla definir, nos aparecerá el siguiente error:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>Uncaught SyntaxError: await is only valid in async functions and the top level bodies of modules
</code></pre></div>
<p>Para solucionarlo, debemos indicar que la función <code>request()</code> es asíncrona, utilizando la palabra clave <code>async</code></p>
<h3 id="async">Async<a class="headerlink" href="#async" title="Permanent link">&para;</a></h3>
<p>Para resolver el problema anterior y poder utilizar el await dentro de nuestra función, sólo tenemos que definir nuestra función como función asíncrona y al llamarla utilizar nuevamente el <code>await</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">request</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="s2">&quot;datos.txt&quot;</span><span class="p">);</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">text</span><span class="p">();</span>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">data</span><span class="p">;</span>
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="p">}</span>
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="k">await</span><span class="w"> </span><span class="nx">request</span><span class="p">();</span>
</code></pre></div>
<p>Sin embargo, vamos a pararnos un poco a pensar esto desde las bases. Definamos dos funciones básicas exactamente iguales, ambas devuelven lo mismo, pero una es síncrona y otra asíncrona:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="kd">function</span><span class="w"> </span><span class="nx">sincrona</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="mf">42</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">asincrona</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="mf">42</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="nx">sincrona</span><span class="p">();</span><span class="w">   </span><span class="c1">// 42</span>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="nx">asincrona</span><span class="p">();</span><span class="w">  </span><span class="c1">// Promise &lt;fulfilled&gt;: 42</span>
</code></pre></div>
<p>En el caso de la función <code>sincrona()</code> devuelve directamente el valor, sin embargo, en el caso de la función <code>asincrona()</code> devuelve una promesa que se ha cumplido inmediatamente, con el valor 42.</p>
<p>Si queremos reescribirlas como <em>arrow function</em>, se definiría como vemos a continuación, colocando el <code>async</code> justo antes de los parámetros de la <em>arrow function</em>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">sincrona</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mf">42</span><span class="p">;</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="kd">const</span><span class="w"> </span><span class="nx">asincrona</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mf">42</span><span class="p">;</span>
</code></pre></div>
<h3 id="awaitasync-then">Await/Async + .then()<a class="headerlink" href="#awaitasync-then" title="Permanent link">&para;</a></h3>
<p>En algunos casos, como al usar un <code>fetch()</code>, donde tenemos que manejar dos promesas, es posible que nos interese utilizar <code>.then()</code> para la primera promesa y <code>await</code> para la segunda. De esta forma podemos manejarlo todo directamente, sin tener que guardarlo en constantes o variables temporales que no utilizaremos sino una sola vez:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">request</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="s2">&quot;datos.txt&quot;</span><span class="p">)</span>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="w">      </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">response</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">text</span><span class="p">());</span>
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="p">}</span>
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="k">await</span><span class="w"> </span><span class="nx">request</span><span class="p">();</span>
</code></pre></div>
<p>En este caso, observa que el <code>fetch()</code> devuelve una primera <em>Promise</em> que es manejada por el <code>.then()</code>. La segunda <em>Promise</em>, devuelta por el método <code>response.text()</code> se devuelve hacia fuera y es manejada por el <code>await</code>, que espera a que se cumpla, y una vez cumplida, se devuelve como valor de la función <code>request()</code>.</p>
<h3 id="asincronia-en-asyncawait">Asincronía en async/await<a class="headerlink" href="#asincronia-en-asyncawait" title="Permanent link">&para;</a></h3>
<p>Volvamos al ejemplo de las tiradas de dados. La función <code>doTask()</code> realiza 10 lanzamientos de un dado y nos devuelve los resultados obtenidos o detiene la tarea si se obtiene un 6. La implementación de la función sufre algunos cambios, simplificándose considerablemente.</p>
<ul>
<li>En primer lugar, añadimos la palabra clave <code>async</code> antes de los parámetros de la <em>arrow function</em>.</li>
<li>En segundo lugar, desaparece cualquier mención a promesas, se devuelven directamente los objetos, ya que al ser una función <code>async</code> se devolverá todo envuelto en una <em>Promise</em>:</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">doTask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">iterations</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">numbers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a>
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">let</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">iterations</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">6</span><span class="p">);</span>
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="w">    </span><span class="nx">numbers</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">number</span><span class="p">);</span>
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">number</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">6</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a><span class="w">        </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a><span class="w">        </span><span class="nx">message</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Se ha sacado un 6&quot;</span>
<a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a><span class="w">      </span><span class="p">};</span>
<a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a>
<a id="__codelineno-14-15" name="__codelineno-14-15" href="#__codelineno-14-15"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-16" name="__codelineno-14-16" href="#__codelineno-14-16"></a><span class="w">    </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<a id="__codelineno-14-17" name="__codelineno-14-17" href="#__codelineno-14-17"></a><span class="w">    </span><span class="nx">value</span><span class="o">:</span><span class="w"> </span><span class="nx">numbers</span>
<a id="__codelineno-14-18" name="__codelineno-14-18" href="#__codelineno-14-18"></a><span class="w">  </span><span class="p">};</span>
<a id="__codelineno-14-19" name="__codelineno-14-19" href="#__codelineno-14-19"></a><span class="p">}</span>
</code></pre></div>
<p>Pero donde se introducen cambios considerables es a la hora de consumir las promesas con <code>async</code>/<code>await</code>. No tendríamos que utilizar <code>.then()</code>, sino que podemos simplemente utilizar <code>await</code> para esperar la resolución de la promesa, obteniendo el valor directamente:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">resultado</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">doTask</span><span class="p">(</span><span class="mf">10</span><span class="p">);</span><span class="w">   </span><span class="c1">// Devuelve un objeto, no una promesa</span>
</code></pre></div>
<p>Observa que el <code>await</code> se utiliza dentro de una función <code>async</code>, por lo que la función que lo contenga debe ser asíncrona:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">consume</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">doTask</span><span class="p">(</span><span class="mf">10</span><span class="p">);</span>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Error: &quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">result</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Los números son: &quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">result</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
<a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a><span class="p">}</span>
</code></pre></div>
<div class="admonition question">
<p class="admonition-title">ACTIVIDAD 4: <code>📂 UD5/act04/</code></p>
<ul>
<li>Crea un fichero <code>index.html</code> con un <strong>botón</strong> que al pulsarlo llame a la función <code>getRandomMessage()</code>.</li>
<li>Crea un fichero <code>script.js</code> con la función <code>getRandomMessage()</code> y la función <code>getMessages()</code>.</li>
<li>Descarga el archivo <a href="https://raw.githubusercontent.com/yesinteractive/dadjokes/master/controllers/jokes.txt"><code>jokes.txt</code></a> y guárdalo en la carpeta <code>UD5/act04/</code>.</li>
<li>La función <code>getMessages()</code> hará un <code>fetch()</code> a <code>jokes.txt</code> y devolverá una promesa con el texto.</li>
<li>La función <code>getRandomMessage()</code> debe llamar a <code>getMessages()</code> dividir el texto en líneas (<code>.split('\n')</code>) y devolver una línea aleatoria que aparecerá en un <code>alert()</code>.</li>
</ul>
</div>
<h2 id="peticiones-ajax">Peticiones Ajax<a class="headerlink" href="#peticiones-ajax" title="Permanent link">&para;</a></h2>
<p>AJAX es el acrónimo de <strong><em>Asynchronous Javascript And XML</em></strong> (Javascript asíncrono y XML) y es lo que usamos para hacer peticiones asíncronas al servidor desde Javascript. Cuando hacemos una petición al servidor no nos responde inmediatamente (la petición tiene que llegar al servidor, procesarse allí y enviarse la respuesta que llegará al cliente). </p>
<p>Lo que significa <strong>asíncrono</strong> es que la página no permanecerá bloqueada esperando esa respuesta sino que continuará ejecutando su código e interactuando con el usuario, y en el momento en que llegue la respuesta del servidor se ejecutará la función que indicamos al hacer la llamada Ajax. Respecto a <strong>XML</strong>, es el formato en que se intercambia la información entre el servidor y el cliente, aunque actualmente el formato más usado es <strong>JSON</strong> que es más simple y legible.</p>
<p>Básicamente Ajax nos permite poder mostrar nuevos datos enviados por el servidor sin tener que recargar la página, que continuará disponible mientras se reciben y procesan los datos enviados por el servidor en segundo plano.</p>
<p><a title="By DanielSHaischt, via Wikimedia Commons [CC BY-SA 3.0 
 (https://creativecommons.org/licenses/by-sa/3.0
)], via Wikimedia Commons" href="https://commons.wikimedia.org/wiki/File:Ajax-vergleich-en.svg"><img width="512" alt="Ajax-vergleich-en" src="https://upload.wikimedia.org/wikipedia/commons/thumb/0/0b/Ajax-vergleich-en.svg/512px-Ajax-vergleich-en.svg.png"></a></p>
<p>Sin Ajax cada vez que necesitamos nuevos datos del servidor la página deja de estar disponible para el usuario hasta que se recarga con lo que envía el servidor. Con Ajax la página está siempre disponible para el usuario y simplemente se modifica (cambiando el DOM) cuando llegan los datos del servidor:</p>
<p><img alt="Uniwebsidad: Introducción a Ajax" src="https://uniwebsidad.com/static/libros/imagenes/ajax/f0103.gif" />
<em>Fuente Uniwebsidad</em></p>
<h3 id="metodos-http">Métodos HTTP<a class="headerlink" href="#metodos-http" title="Permanent link">&para;</a></h3>
<p>Las peticiones Ajax usan el protocolo HTTP (el mismo que utiliza el navegador para cargar una página). Este protocolo envía al servidor unas cabeceras HTTP (con información como el <em>userAgent</em> del navegador, el idioma, etc), el tipo de petición y, opcionalmente, datos o parámetros (por ejemplo en la petición que procesa un formulario se envían los datos del mismo).</p>
<p>Hay diferentes tipos de petición que podemos hacer:</p>
<ul>
<li><strong><code>GET</code></strong>: suele usarse para <strong>obtener datos</strong> sin modificar nada (equivale a un <code>SELECT</code> en <em>SQL</em>). Si enviamos datos (ej. la <code>ID</code> del registro a obtener) suelen ir en la <em>url</em> de la petición (formato <em>URIEncoded</em>). Ej.: <code>locahost/users/3</code>, <a href="https://jsonplaceholder.typicode.com/users">https://jsonplaceholder.typicode.com/users</a></li>
<li><strong><code>POST</code></strong>: suele usarse para <strong>añadir un dato</strong> en el servidor (equivalente a un <code>INSERT</code> de <em>SQL</em>). Los datos enviados van en el cuerpo de la petición HTTP (igual que sucede al enviar desde el navegador un formulario por <em>POST</em>)</li>
<li><strong><code>PUT</code></strong>: es similar al <em>POST</em> pero suele usarse para <strong>actualizar datos</strong> del servidor (como un <code>UPDATE</code> de <em>SQL</em>). Los datos se envían en el cuerpo de la petición (como en el <em>POST</em>) y la información para identificar el objeto a modificar en la url (como en el <code>GET</code>). El servidor hará un <code>UPDATE</code> sustituyendo el objeto actual por el que se le pasa como parámetro</li>
<li><strong><code>PATCH</code></strong>: es similar al <em>PUT</em> pero la diferencia es que en el <em>PUT</em> hay que pasar todos los campos del objeto a modificar (los campos no pasados se eliminan del objeto) mientras que en el <em>PATCH</em> sólo se pasan los campos que se quieren cambiar y en resto permanecen como están.</li>
<li><strong><code>DELETE</code></strong>: se usa para eliminar un dato del servidor (como un <code>DELETE</code> de <em>SQL</em>). La información para identificar el objeto a eliminar se envía en la url (como en el <em>GET</em>)</li>
</ul>
<p>El servidor acepta la petición, la procesa y le envía una respuesta al cliente con el recurso solicitado y además unas cabeceras de respuesta (con el tipo de contenido enviado, el idioma, etc) y el código de estado. Los códigos de estado más comunes son:</p>
<ul>
<li><code>2xx</code>: son peticiones procesadas <strong>correctamente</strong>. Las más usuales son <code>200</code> (<em>ok</em>) o <code>201</code> (<em>created</em>, como respuesta a una petición <em>POST</em> satisfactoria)</li>
<li><code>3xx</code>: son códigos de <strong>redirección</strong> que indican que la petición se redirecciona a otro recurso del servidor, como <code>301</code> (el recurso se ha movido permanentemente a otra URL) o <code>304</code> (el recurso no ha cambiado desde la última petición por lo que se puede recuperar desde la caché)</li>
<li><code>4xx</code>: indican un <strong>error</strong> por parte del <strong>cliente</strong>, como <code>404</code> (<em>Not found</em>, no existe el recurso solicitado) o <code>401</code> (<em>Not authorized</em>, el cliente no está autorizado a acceder al recurso solicitado)</li>
<li><code>5xx</code>: indican un <strong>error</strong> por parte del <strong>servidor</strong>, como <code>500</code> (error interno del servidor) o <code>504</code> (<em>timeout</em>, el servidor no responde).</li>
</ul>
<p>En cuanto a la información enviada por el servidor al cliente normalmente serán datos en formato <strong>JSON</strong> o XML (cada vez menos usado) que el cliente procesará y mostrará en la página al usuario. También podría ser HTML, texto plano, etc.</p>
<p>El formato <em>JSON</em> es una forma de convertir un objeto Javascript en una cadena de texto para poderla enviar, por ejemplo el objeto</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="kd">let</span><span class="w"> </span><span class="nx">alumno</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="w">  </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="mf">5</span><span class="p">,</span>
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="w">  </span><span class="nx">nombre</span><span class="o">:</span><span class="w"> </span><span class="nx">Marta</span><span class="p">,</span>
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="w">  </span><span class="nx">apellidos</span><span class="o">:</span><span class="w"> </span><span class="nx">Pérez</span><span class="w"> </span><span class="nx">Rodríguez</span>
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="p">}</span>
</code></pre></div>
<p>se transformaría en la cadena de texto</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="p">{</span><span class="w"> </span><span class="s2">&quot;id&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">5</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;nombre&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Marta&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;apellidos&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Pérez Rodríguez&quot;</span><span class="w"> </span><span class="p">}</span>
</code></pre></div>
<p>y el array</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="kd">let</span><span class="w"> </span><span class="nx">alumnos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="w">  </span><span class="p">{</span>
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="w">    </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="mf">5</span><span class="p">,</span>
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="w">    </span><span class="nx">nombre</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Marta&quot;</span><span class="p">,</span>
<a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a><span class="w">    </span><span class="nx">apellidos</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Pérez Rodríguez&quot;</span>
<a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a><span class="w">  </span><span class="p">},</span>
<a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a><span class="w">  </span><span class="p">{</span>
<a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a><span class="w">    </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="mf">7</span><span class="p">,</span>
<a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a><span class="w">    </span><span class="nx">nombre</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Joan&quot;</span><span class="p">,</span>
<a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a><span class="w">    </span><span class="nx">apellidos</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Reig Peris&quot;</span>
<a id="__codelineno-19-11" name="__codelineno-19-11" href="#__codelineno-19-11"></a><span class="w">  </span><span class="p">},</span>
<a id="__codelineno-19-12" name="__codelineno-19-12" href="#__codelineno-19-12"></a><span class="p">]</span>
</code></pre></div>
<p>en la cadena:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="p">[{</span><span class="w"> </span><span class="s2">&quot;id&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">5</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;nombre&quot;</span><span class="o">:</span><span class="w"> </span><span class="nx">Marta</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;apellidos&quot;</span><span class="o">:</span><span class="w"> </span><span class="nx">Pérez</span><span class="w"> </span><span class="nx">Rodríguez</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;id&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">7</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;nombre&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Joan&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;apellidos&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Reig Peris&quot;</span><span class="w"> </span><span class="p">}]</span>
</code></pre></div>
<p>Para convertir objetos en cadenas de texto <em>JSON</em> y viceversa Javascript proporciona 2 funciones:</p>
<ul>
<li><strong>JSON.stringify(<em>objeto</em>)</strong>: recibe un objeto JS y devuelve la cadena de texto correspondiente. Ej.: <code>const cadenaAlumnos = JSON.stringify(alumnos)</code></li>
<li><strong>JSON.parse(<em>cadena</em>)</strong>: realiza el proceso inverso, convirtiendo una cadena de texto en un objeto. Ej.: <code>const alumnos = JSON.parse(cadenaAlumnos)</code></li>
</ul>
<h2 id="api-fetch"><em>API Fetch</em><a class="headerlink" href="#api-fetch" title="Permanent link">&para;</a></h2>
<p>La <a href="https://developer.mozilla.org/es/docs/Web/API/Fetch_API/Utilizando_Fetch">API Fetch</a> permite realizar una petición Ajax genérica que directamente devuelve en forma de <strong>promesa</strong>. </p>
<p>La API Fetch proporciona una interfaz <em>JavaScript</em> para acceder y manipular partes del canal HTTP, tales como peticiones y respuestas. También provee un método global <code>fetch()</code> que proporciona una forma fácil y lógica de obtener recursos de forma asíncrona por la red.</p>
<ul>
<li>
<p><strong><em><code>fetch</code></em> devuelve los datos "en crudo"</strong> por lo que si la respuesta está en formato JSON habrá con convertirlos. Para ello dispone del método <strong><em><code>.json()</code></em></strong> que hace el <code>JSON.parse</code>. Este método devuelve una nueva promesa a la que nos suscribimos con un nuevo <em><code>.then()</code></em>. Ejemplo.:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;https://jsonplaceholder.typicode.com/posts?userId=&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">idUser</span><span class="p">)</span>
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">response</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">())</span><span class="w">    </span><span class="c1">// los datos son una cadena JSON</span>
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">myData</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a><span class="w">    </span><span class="c1">// ya tenemos los datos en _myData_ como un objeto o array</span>
<a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a><span class="w">    </span><span class="c1">// Aquí procesamos los datos</span>
<a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">myData</span><span class="p">)</span>
<a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a><span class="p">})</span><span class="w"> </span>
<a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a><span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">err</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">));</span>
</code></pre></div>
</li>
<li>
<p><strong><em><code>fetch</code></em> llama a <em><code>resolve</code></em> siempre que el servidor conteste</strong>, sin comprobar si la respuesta es de éxito (<code>200</code>, <code>201</code>, etc.) o de error (<code>4xx</code>, <code>5xx</code>). Por tanto siempre se ejecutará el <em><code>then</code></em> excepto si se trata de un error de red y el servidor no responde.</p>
</li>
</ul>
<h4 id="propiedades-y-metodos-de-la-respuesta">Propiedades y métodos de la respuesta<a class="headerlink" href="#propiedades-y-metodos-de-la-respuesta" title="Permanent link">&para;</a></h4>
<p>La respuesta devuelta por <em><code>fetch()</code></em> tiene las siguientes propiedades y métodos:</p>
<ul>
<li><strong><code>status</code></strong>: el <strong>código de estado</strong> devuelto por el servidor (<code>200</code>, <code>404</code>, etc.)</li>
<li><strong><code>statusText</code></strong>: el texto correspondiente a ese código (<code>Ok</code>, <code>Not found</code>, etc.)</li>
<li><strong><code>ok</code></strong>: booleano que vale <em><code>true</code></em> si el status está entre <code>200</code> y <code>299</code> y <em><code>false</code></em> en caso contrario</li>
<li><strong><code>json()</code></strong>: devuelve una promesa que se resolverá con los datos de la respuesta convertidos a un objeto (les hace un <em>JSON.parse()</em>) </li>
<li>otros métodos para convertir los datos según el formato que tengan: <strong><code>text()</code></strong>, <strong><code>blob()</code></strong>, <strong><code>formData()</code></strong>, etc. Todos devuelven una promesa con los datos de distintos formatos convertidos.</li>
</ul>
<p><strong>Ejemplo</strong> de usando <em><strong><code>fetch()</code></strong></em> para obtener los <code>posts</code> de un usuario y presentarlos en una tabla:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">index.html</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-22-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-22-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-22-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-22-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-22-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-22-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-22-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-22-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-22-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-22-10">10</a></span>
<span class="normal"><a href="#__codelineno-22-11">11</a></span>
<span class="normal"><a href="#__codelineno-22-12">12</a></span>
<span class="normal"><a href="#__codelineno-22-13">13</a></span>
<span class="normal"><a href="#__codelineno-22-14">14</a></span>
<span class="normal"><a href="#__codelineno-22-15">15</a></span>
<span class="normal"><a href="#__codelineno-22-16">16</a></span>
<span class="normal"><a href="#__codelineno-22-17">17</a></span>
<span class="normal"><a href="#__codelineno-22-18">18</a></span>
<span class="normal"><a href="#__codelineno-22-19">19</a></span>
<span class="normal"><a href="#__codelineno-22-20">20</a></span>
<span class="normal"><a href="#__codelineno-22-21">21</a></span>
<span class="normal"><a href="#__codelineno-22-22">22</a></span>
<span class="normal"><a href="#__codelineno-22-23">23</a></span>
<span class="normal"><a href="#__codelineno-22-24">24</a></span>
<span class="normal"><a href="#__codelineno-22-25">25</a></span>
<span class="normal"><a href="#__codelineno-22-26">26</a></span>
<span class="normal"><a href="#__codelineno-22-27">27</a></span>
<span class="normal"><a href="#__codelineno-22-28">28</a></span>
<span class="normal"><a href="#__codelineno-22-29">29</a></span>
<span class="normal"><a href="#__codelineno-22-30">30</a></span>
<span class="normal"><a href="#__codelineno-22-31">31</a></span>
<span class="normal"><a href="#__codelineno-22-32">32</a></span>
<span class="normal"><a href="#__codelineno-22-33">33</a></span>
<span class="normal"><a href="#__codelineno-22-34">34</a></span>
<span class="normal"><a href="#__codelineno-22-35">35</a></span>
<span class="normal"><a href="#__codelineno-22-36">36</a></span>
<span class="normal"><a href="#__codelineno-22-37">37</a></span>
<span class="normal"><a href="#__codelineno-22-38">38</a></span>
<span class="normal"><a href="#__codelineno-22-39">39</a></span>
<span class="normal"><a href="#__codelineno-22-40">40</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1"></a><span class="cp">&lt;!DOCTYPE html&gt;</span>
<a id="__codelineno-22-2" name="__codelineno-22-2"></a><span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&quot;en&quot;</span><span class="p">&gt;</span>
<a id="__codelineno-22-3" name="__codelineno-22-3"></a><span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
<a id="__codelineno-22-4" name="__codelineno-22-4"></a>  <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="p">&gt;</span>
<a id="__codelineno-22-5" name="__codelineno-22-5"></a>  <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;viewport&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;width=device-width, initial-scale=1.0&quot;</span><span class="p">&gt;</span>
<a id="__codelineno-22-6" name="__codelineno-22-6"></a>  <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>REST Client<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<a id="__codelineno-22-7" name="__codelineno-22-7"></a>  <span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;module&quot;</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;main.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<a id="__codelineno-22-8" name="__codelineno-22-8"></a><span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<a id="__codelineno-22-9" name="__codelineno-22-9"></a>
<a id="__codelineno-22-10" name="__codelineno-22-10"></a><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
<a id="__codelineno-22-11" name="__codelineno-22-11"></a>
<a id="__codelineno-22-12" name="__codelineno-22-12"></a>  <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Mostrar posts de un usuario<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<a id="__codelineno-22-13" name="__codelineno-22-13"></a>
<a id="__codelineno-22-14" name="__codelineno-22-14"></a>  <span class="cm">&lt;!-- FORMULARIO para introducir el id del usuario --&gt;</span>
<a id="__codelineno-22-15" name="__codelineno-22-15"></a>
<a id="__codelineno-22-16" name="__codelineno-22-16"></a>  <span class="p">&lt;</span><span class="nt">form</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;form-user-posts&quot;</span><span class="p">&gt;</span>
<a id="__codelineno-22-17" name="__codelineno-22-17"></a>    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<a id="__codelineno-22-18" name="__codelineno-22-18"></a>      <span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;user-id&quot;</span><span class="p">&gt;</span>Introduce el id del usuario: <span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
<a id="__codelineno-22-19" name="__codelineno-22-19"></a>      <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;user-id&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;userId&quot;</span> <span class="na">size</span><span class="o">=</span><span class="s">&quot;2&quot;</span><span class="p">&gt;</span>
<a id="__codelineno-22-20" name="__codelineno-22-20"></a>      <span class="p">&lt;</span><span class="nt">span</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;error-message&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;error&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<a id="__codelineno-22-21" name="__codelineno-22-21"></a>    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<a id="__codelineno-22-22" name="__codelineno-22-22"></a>    <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span><span class="p">&gt;</span>Mostrar posts<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<a id="__codelineno-22-23" name="__codelineno-22-23"></a>  <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
<a id="__codelineno-22-24" name="__codelineno-22-24"></a>
<a id="__codelineno-22-25" name="__codelineno-22-25"></a>  <span class="cm">&lt;!-- TABLA para mostrar los posts --&gt;</span>
<a id="__codelineno-22-26" name="__codelineno-22-26"></a>
<a id="__codelineno-22-27" name="__codelineno-22-27"></a>  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;user-posts&quot;</span><span class="p">&gt;</span>
<a id="__codelineno-22-28" name="__codelineno-22-28"></a>    <span class="p">&lt;</span><span class="nt">table</span><span class="p">&gt;</span>
<a id="__codelineno-22-29" name="__codelineno-22-29"></a>      <span class="p">&lt;</span><span class="nt">thead</span><span class="p">&gt;</span>
<a id="__codelineno-22-30" name="__codelineno-22-30"></a>        <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;&lt;</span><span class="nt">th</span><span class="p">&gt;</span>userId<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;&lt;</span><span class="nt">th</span><span class="p">&gt;</span>Id<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;&lt;</span><span class="nt">th</span><span class="p">&gt;</span>Título<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;&lt;</span><span class="nt">th</span><span class="p">&gt;</span>Post<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
<a id="__codelineno-22-31" name="__codelineno-22-31"></a>      <span class="p">&lt;/</span><span class="nt">thead</span><span class="p">&gt;</span>
<a id="__codelineno-22-32" name="__codelineno-22-32"></a>      <span class="p">&lt;</span><span class="nt">tbody</span><span class="p">&gt;</span>
<a id="__codelineno-22-33" name="__codelineno-22-33"></a>        <span class="cm">&lt;!-- Aquí se añadirán los posts --&gt;</span>
<a id="__codelineno-22-34" name="__codelineno-22-34"></a>      <span class="p">&lt;/</span><span class="nt">tbody</span><span class="p">&gt;</span>
<a id="__codelineno-22-35" name="__codelineno-22-35"></a>    <span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>
<a id="__codelineno-22-36" name="__codelineno-22-36"></a>    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Total: <span class="p">&lt;</span><span class="nt">span</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;num-posts&quot;</span><span class="p">&gt;</span><span class="cm">&lt;!-- Aquí se mostrará el total --&gt;</span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<a id="__codelineno-22-37" name="__codelineno-22-37"></a>  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<a id="__codelineno-22-38" name="__codelineno-22-38"></a>
<a id="__codelineno-22-39" name="__codelineno-22-39"></a><span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<a id="__codelineno-22-40" name="__codelineno-22-40"></a><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">main.js</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-23-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-23-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-23-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-23-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-23-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-23-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-23-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-23-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-23-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-23-10">10</a></span>
<span class="normal"><a href="#__codelineno-23-11">11</a></span>
<span class="normal"><a href="#__codelineno-23-12">12</a></span>
<span class="normal"><a href="#__codelineno-23-13">13</a></span>
<span class="normal"><a href="#__codelineno-23-14">14</a></span>
<span class="normal"><a href="#__codelineno-23-15">15</a></span>
<span class="normal"><a href="#__codelineno-23-16">16</a></span>
<span class="normal"><a href="#__codelineno-23-17">17</a></span>
<span class="normal"><a href="#__codelineno-23-18">18</a></span>
<span class="normal"><a href="#__codelineno-23-19">19</a></span>
<span class="normal"><a href="#__codelineno-23-20">20</a></span>
<span class="normal"><a href="#__codelineno-23-21">21</a></span>
<span class="normal"><a href="#__codelineno-23-22">22</a></span>
<span class="normal"><a href="#__codelineno-23-23">23</a></span>
<span class="normal"><a href="#__codelineno-23-24">24</a></span>
<span class="normal"><a href="#__codelineno-23-25">25</a></span>
<span class="normal"><a href="#__codelineno-23-26">26</a></span>
<span class="normal"><a href="#__codelineno-23-27">27</a></span>
<span class="normal"><a href="#__codelineno-23-28">28</a></span>
<span class="normal"><a href="#__codelineno-23-29">29</a></span>
<span class="normal"><a href="#__codelineno-23-30">30</a></span>
<span class="normal"><a href="#__codelineno-23-31">31</a></span>
<span class="normal"><a href="#__codelineno-23-32">32</a></span>
<span class="normal"><a href="#__codelineno-23-33">33</a></span>
<span class="normal"><a href="#__codelineno-23-34">34</a></span>
<span class="normal"><a href="#__codelineno-23-35">35</a></span>
<span class="normal"><a href="#__codelineno-23-36">36</a></span>
<span class="normal"><a href="#__codelineno-23-37">37</a></span>
<span class="normal"><a href="#__codelineno-23-38">38</a></span>
<span class="normal"><a href="#__codelineno-23-39">39</a></span>
<span class="normal"><a href="#__codelineno-23-40">40</a></span>
<span class="normal"><a href="#__codelineno-23-41">41</a></span>
<span class="normal"><a href="#__codelineno-23-42">42</a></span>
<span class="normal"><a href="#__codelineno-23-43">43</a></span>
<span class="normal"><a href="#__codelineno-23-44">44</a></span>
<span class="normal"><a href="#__codelineno-23-45">45</a></span>
<span class="normal"><a href="#__codelineno-23-46">46</a></span>
<span class="normal"><a href="#__codelineno-23-47">47</a></span>
<span class="normal"><a href="#__codelineno-23-48">48</a></span>
<span class="normal"><a href="#__codelineno-23-49">49</a></span>
<span class="normal"><a href="#__codelineno-23-50">50</a></span>
<span class="normal"><a href="#__codelineno-23-51">51</a></span>
<span class="normal"><a href="#__codelineno-23-52">52</a></span>
<span class="normal"><a href="#__codelineno-23-53">53</a></span>
<span class="normal"><a href="#__codelineno-23-54">54</a></span>
<span class="normal"><a href="#__codelineno-23-55">55</a></span>
<span class="normal"><a href="#__codelineno-23-56">56</a></span>
<span class="normal"><a href="#__codelineno-23-57">57</a></span>
<span class="normal"><a href="#__codelineno-23-58">58</a></span>
<span class="normal"><a href="#__codelineno-23-59">59</a></span>
<span class="normal"><a href="#__codelineno-23-60">60</a></span>
<span class="normal"><a href="#__codelineno-23-61">61</a></span>
<span class="normal"><a href="#__codelineno-23-62">62</a></span>
<span class="normal"><a href="#__codelineno-23-63">63</a></span>
<span class="normal"><a href="#__codelineno-23-64">64</a></span>
<span class="normal"><a href="#__codelineno-23-65">65</a></span>
<span class="normal"><a href="#__codelineno-23-66">66</a></span>
<span class="normal"><a href="#__codelineno-23-67">67</a></span>
<span class="normal"><a href="#__codelineno-23-68">68</a></span>
<span class="normal"><a href="#__codelineno-23-69">69</a></span>
<span class="normal"><a href="#__codelineno-23-70">70</a></span>
<span class="normal"><a href="#__codelineno-23-71">71</a></span>
<span class="normal"><a href="#__codelineno-23-72">72</a></span>
<span class="normal"><a href="#__codelineno-23-73">73</a></span>
<span class="normal"><a href="#__codelineno-23-74">74</a></span>
<span class="normal"><a href="#__codelineno-23-75">75</a></span>
<span class="normal"><a href="#__codelineno-23-76">76</a></span>
<span class="normal"><a href="#__codelineno-23-77">77</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">SERVER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;https://jsonplaceholder.typicode.com&quot;</span><span class="p">;</span>
<a id="__codelineno-23-2" name="__codelineno-23-2"></a>
<a id="__codelineno-23-3" name="__codelineno-23-3"></a><span class="kd">const</span><span class="w"> </span><span class="nx">form</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;form-user-posts&quot;</span><span class="p">);</span>
<a id="__codelineno-23-4" name="__codelineno-23-4"></a><span class="kd">const</span><span class="w"> </span><span class="nx">errorMessage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;error-message&quot;</span><span class="p">);</span>
<a id="__codelineno-23-5" name="__codelineno-23-5"></a><span class="kd">const</span><span class="w"> </span><span class="nx">userPosts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;user-posts&quot;</span><span class="p">);</span>
<a id="__codelineno-23-6" name="__codelineno-23-6"></a><span class="kd">const</span><span class="w"> </span><span class="nx">postTbody</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">&quot;tbody&quot;</span><span class="p">);</span>
<a id="__codelineno-23-7" name="__codelineno-23-7"></a>
<a id="__codelineno-23-8" name="__codelineno-23-8"></a><span class="nx">hideError</span><span class="p">();</span>
<a id="__codelineno-23-9" name="__codelineno-23-9"></a><span class="nx">userPosts</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;none&quot;</span><span class="p">;</span>
<a id="__codelineno-23-10" name="__codelineno-23-10"></a>
<a id="__codelineno-23-11" name="__codelineno-23-11"></a><span class="nx">form</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;submit&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">event</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-23-12" name="__codelineno-23-12"></a><span class="w">  </span><span class="c1">// evitamos que se envíe el formulario y se recargue la página</span>
<a id="__codelineno-23-13" name="__codelineno-23-13"></a><span class="w">  </span><span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
<a id="__codelineno-23-14" name="__codelineno-23-14"></a>
<a id="__codelineno-23-15" name="__codelineno-23-15"></a><span class="w">  </span><span class="c1">// ocultamos el mensaje de error y la tabla de posts</span>
<a id="__codelineno-23-16" name="__codelineno-23-16"></a><span class="w">  </span><span class="nx">userPosts</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;none&quot;</span><span class="p">;</span>
<a id="__codelineno-23-17" name="__codelineno-23-17"></a><span class="w">  </span><span class="nx">hideError</span><span class="p">();</span>
<a id="__codelineno-23-18" name="__codelineno-23-18"></a>
<a id="__codelineno-23-19" name="__codelineno-23-19"></a><span class="w">  </span><span class="c1">// obtenemos el id del usuario</span>
<a id="__codelineno-23-20" name="__codelineno-23-20"></a><span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="nx">inputIdUser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">[</span><span class="s2">&quot;user-id&quot;</span><span class="p">];</span>
<a id="__codelineno-23-21" name="__codelineno-23-21"></a><span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="nx">idUser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">inputIdUser</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
<a id="__codelineno-23-22" name="__codelineno-23-22"></a>
<a id="__codelineno-23-23" name="__codelineno-23-23"></a><span class="w">  </span><span class="c1">// comprobamos que el id sea un número</span>
<a id="__codelineno-23-24" name="__codelineno-23-24"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">isNaN</span><span class="p">(</span><span class="nx">idUser</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">idUser</span><span class="p">.</span><span class="nx">trim</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-23-25" name="__codelineno-23-25"></a><span class="w">    </span><span class="nx">showError</span><span class="p">(</span><span class="s2">&quot;Debes introducir un número&quot;</span><span class="p">);</span>
<a id="__codelineno-23-26" name="__codelineno-23-26"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-23-27" name="__codelineno-23-27"></a><span class="w">    </span><span class="c1">// creamos la petición GET para obtener los posts del usuario</span>
<a id="__codelineno-23-28" name="__codelineno-23-28"></a><span class="w">    </span><span class="nx">fetch</span><span class="p">(</span><span class="nx">SERVER</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot;/posts?userId=&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">idUser</span><span class="p">)</span>
<a id="__codelineno-23-29" name="__codelineno-23-29"></a><span class="w">      </span><span class="c1">// convertimos la respuesta de texto a objeto</span>
<a id="__codelineno-23-30" name="__codelineno-23-30"></a><span class="w">      </span><span class="c1">// en este caso, la respuesta es un array de posts</span>
<a id="__codelineno-23-31" name="__codelineno-23-31"></a><span class="w">      </span><span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">response</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">())</span>
<a id="__codelineno-23-32" name="__codelineno-23-32"></a><span class="w">      </span><span class="c1">// en posts tenemos un array con los posts del usuario</span>
<a id="__codelineno-23-33" name="__codelineno-23-33"></a><span class="w">      </span><span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">posts</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-23-34" name="__codelineno-23-34"></a><span class="w">        </span><span class="c1">// mostramos los posts en la tabla</span>
<a id="__codelineno-23-35" name="__codelineno-23-35"></a><span class="w">        </span><span class="nx">postTbody</span><span class="p">.</span><span class="nx">innerHTML</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">;</span>
<a id="__codelineno-23-36" name="__codelineno-23-36"></a>
<a id="__codelineno-23-37" name="__codelineno-23-37"></a><span class="w">        </span><span class="c1">// si no hay posts, mostramos un mensaje de error</span>
<a id="__codelineno-23-38" name="__codelineno-23-38"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">posts</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-23-39" name="__codelineno-23-39"></a><span class="w">          </span><span class="nx">showError</span><span class="p">(</span><span class="s2">&quot;No hay posts para este usuario&quot;</span><span class="p">);</span>
<a id="__codelineno-23-40" name="__codelineno-23-40"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-23-41" name="__codelineno-23-41"></a><span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-23-42" name="__codelineno-23-42"></a><span class="w">          </span><span class="c1">// mostramos los posts en la tabla</span>
<a id="__codelineno-23-43" name="__codelineno-23-43"></a><span class="w">          </span><span class="nx">posts</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">post</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-23-44" name="__codelineno-23-44"></a><span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">newPost</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;tr&quot;</span><span class="p">);</span>
<a id="__codelineno-23-45" name="__codelineno-23-45"></a><span class="w">            </span><span class="nx">newPost</span><span class="p">.</span><span class="nx">innerHTML</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`</span>
<a id="__codelineno-23-46" name="__codelineno-23-46"></a><span class="sb">                  &lt;td&gt;</span><span class="si">${</span><span class="nx">post</span><span class="p">.</span><span class="nx">userId</span><span class="si">}</span><span class="sb">&lt;/td&gt;</span>
<a id="__codelineno-23-47" name="__codelineno-23-47"></a><span class="sb">                  &lt;td&gt;</span><span class="si">${</span><span class="nx">post</span><span class="p">.</span><span class="nx">id</span><span class="si">}</span><span class="sb">&lt;/td&gt;</span>
<a id="__codelineno-23-48" name="__codelineno-23-48"></a><span class="sb">                  &lt;td&gt;</span><span class="si">${</span><span class="nx">post</span><span class="p">.</span><span class="nx">title</span><span class="si">}</span><span class="sb">&lt;/td&gt;</span>
<a id="__codelineno-23-49" name="__codelineno-23-49"></a><span class="sb">                  &lt;td&gt;</span><span class="si">${</span><span class="nx">post</span><span class="p">.</span><span class="nx">body</span><span class="si">}</span><span class="sb">&lt;/td&gt;`</span><span class="p">;</span>
<a id="__codelineno-23-50" name="__codelineno-23-50"></a><span class="w">            </span><span class="nx">postTbody</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">newPost</span><span class="p">);</span>
<a id="__codelineno-23-51" name="__codelineno-23-51"></a><span class="w">          </span><span class="p">});</span>
<a id="__codelineno-23-52" name="__codelineno-23-52"></a>
<a id="__codelineno-23-53" name="__codelineno-23-53"></a><span class="w">          </span><span class="c1">// mostramos el número de posts</span>
<a id="__codelineno-23-54" name="__codelineno-23-54"></a><span class="w">          </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;num-posts&quot;</span><span class="p">).</span><span class="nx">textContent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">posts</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
<a id="__codelineno-23-55" name="__codelineno-23-55"></a>
<a id="__codelineno-23-56" name="__codelineno-23-56"></a><span class="w">          </span><span class="c1">// por último, mostramos el resultado</span>
<a id="__codelineno-23-57" name="__codelineno-23-57"></a><span class="w">          </span><span class="nx">userPosts</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;block&quot;</span><span class="p">;</span>
<a id="__codelineno-23-58" name="__codelineno-23-58"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-23-59" name="__codelineno-23-59"></a><span class="w">      </span><span class="p">})</span>
<a id="__codelineno-23-60" name="__codelineno-23-60"></a><span class="w">      </span><span class="p">.</span><span class="k">catch</span><span class="p">((</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">showError</span><span class="p">(</span><span class="nx">error</span><span class="p">));</span>
<a id="__codelineno-23-61" name="__codelineno-23-61"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-23-62" name="__codelineno-23-62"></a>
<a id="__codelineno-23-63" name="__codelineno-23-63"></a><span class="w">  </span><span class="c1">// devolvemos el foco al input y seleccionamos su contenido</span>
<a id="__codelineno-23-64" name="__codelineno-23-64"></a><span class="w">  </span><span class="nx">inputIdUser</span><span class="p">.</span><span class="nx">focus</span><span class="p">();</span>
<a id="__codelineno-23-65" name="__codelineno-23-65"></a><span class="w">  </span><span class="nx">inputIdUser</span><span class="p">.</span><span class="nx">select</span><span class="p">();</span>
<a id="__codelineno-23-66" name="__codelineno-23-66"></a><span class="p">});</span>
<a id="__codelineno-23-67" name="__codelineno-23-67"></a>
<a id="__codelineno-23-68" name="__codelineno-23-68"></a><span class="kd">function</span><span class="w"> </span><span class="nx">showError</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-23-69" name="__codelineno-23-69"></a><span class="w">  </span><span class="nx">errorMessage</span><span class="p">.</span><span class="nx">textContent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">message</span><span class="p">;</span>
<a id="__codelineno-23-70" name="__codelineno-23-70"></a><span class="w">  </span><span class="nx">errorMessage</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;red&quot;</span><span class="p">;</span>
<a id="__codelineno-23-71" name="__codelineno-23-71"></a><span class="w">  </span><span class="nx">errorMessage</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;inline-block&quot;</span><span class="p">;</span>
<a id="__codelineno-23-72" name="__codelineno-23-72"></a><span class="p">}</span>
<a id="__codelineno-23-73" name="__codelineno-23-73"></a>
<a id="__codelineno-23-74" name="__codelineno-23-74"></a><span class="kd">function</span><span class="w"> </span><span class="nx">hideError</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-23-75" name="__codelineno-23-75"></a><span class="w">  </span><span class="nx">errorMessage</span><span class="p">.</span><span class="nx">textContent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">;</span>
<a id="__codelineno-23-76" name="__codelineno-23-76"></a><span class="w">  </span><span class="nx">errorMessage</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;none&quot;</span><span class="p">;</span>
<a id="__codelineno-23-77" name="__codelineno-23-77"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Pero este ejemplo fallaría si hubiéramos puesto mal la url ya que contestaría con un <code>404</code> pero se ejecutaría el <em><code>.then()</code></em> igualmente.</p>
<h4 id="gestion-de-errores-con-fetch">Gestión de errores con <em>fetch</em><a class="headerlink" href="#gestion-de-errores-con-fetch" title="Permanent link">&para;</a></h4>
<p>Según <a href="https://developer.mozilla.org/es/docs/Web/API/Fetch_API">MDN</a> la promesa devuelta por la <em>API fetch</em> sólo es rechazada en el caso de un error de red, es decir, el <em><code>.catch()</code></em> sólo saltará si no hemos recibido respuesta del servidor; en caso contrario la promesa siempre es resuelta.</p>
<p>Por tanto para saber si se ha resuelto satisfactoriamente o no debemos comprobar la propiedad <strong><em>.ok</em></strong> de la respuesta. El código correcto del ejemplo anterior gestionando los posibles errores del servidor sería:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-24-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-24-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-24-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-24-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-24-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-24-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-24-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-24-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-24-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-24-10">10</a></span>
<span class="normal"><a href="#__codelineno-24-11">11</a></span>
<span class="normal"><a href="#__codelineno-24-12">12</a></span>
<span class="normal"><a href="#__codelineno-24-13">13</a></span>
<span class="normal"><a href="#__codelineno-24-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1"></a><span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;https://jsonplaceholder.typicode.com/posts?userId=&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">idUser</span><span class="p">)</span>
<a id="__codelineno-24-2" name="__codelineno-24-2"></a><span class="w">  </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">response</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-24-3" name="__codelineno-24-3"></a><span class="hll"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">response</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><a id="__codelineno-24-4" name="__codelineno-24-4"></a><span class="hll"><span class="w">      </span><span class="c1">// lanzamos un error que interceptará el .catch()</span>
</span><a id="__codelineno-24-5" name="__codelineno-24-5"></a><span class="hll"><span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="sb">`Error </span><span class="si">${</span><span class="nx">response</span><span class="p">.</span><span class="nx">status</span><span class="si">}</span><span class="sb"> de la BBDD: </span><span class="si">${</span><span class="nx">response</span><span class="p">.</span><span class="nx">statusText</span><span class="si">}</span><span class="sb">`</span>
</span><a id="__codelineno-24-6" name="__codelineno-24-6"></a><span class="hll"><span class="w">    </span><span class="p">}</span><span class="w"> </span>
</span><a id="__codelineno-24-7" name="__codelineno-24-7"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">()</span><span class="w">  </span><span class="c1">// devolvermos la promesa que hará el JSON.parse          </span>
<a id="__codelineno-24-8" name="__codelineno-24-8"></a><span class="w">  </span><span class="p">})</span>
<a id="__codelineno-24-9" name="__codelineno-24-9"></a><span class="w">  </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">myData</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-24-10" name="__codelineno-24-10"></a><span class="w">    </span><span class="c1">// ya tenemos los datos en _myData_ </span>
<a id="__codelineno-24-11" name="__codelineno-24-11"></a><span class="w">    </span><span class="c1">// Aquí procesamos los datos (en nuestro ejemplo los pintaríamos en la tabla)</span>
<a id="__codelineno-24-12" name="__codelineno-24-12"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">myData</span><span class="p">)</span>
<a id="__codelineno-24-13" name="__codelineno-24-13"></a><span class="w">  </span><span class="p">})</span><span class="w"> </span>
<a id="__codelineno-24-14" name="__codelineno-24-14"></a><span class="hll"><span class="w">  </span><span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">err</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">));</span>
</span></code></pre></div></td></tr></table></div>
<p>En este caso si la respuesta del servidor no es <em><code>ok</code></em> lanzamos un error que es interceptado por nuestro propio <em><code>catch</code></em></p>
<h4 id="otros-metodos-de-peticion">Otros métodos de petición<a class="headerlink" href="#otros-metodos-de-peticion" title="Permanent link">&para;</a></h4>
<p>Los ejemplos anteriores hacen peticiones <code>GET</code> al servidor. Para peticiones que no sean <code>GET</code> la función <em><code>fetch()</code></em> admite un segundo parámetro con un objeto con la información a enviar en la petición HTTP. Ej.:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="nx">fetch</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="w">  </span><span class="nx">method</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;POST&#39;</span><span class="p">,</span><span class="w"> </span><span class="c1">// o &#39;PUT&#39;, &#39;GET&#39;, &#39;DELETE&#39;</span>
<a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a><span class="w">  </span><span class="nx">body</span><span class="o">:</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">data</span><span class="p">),</span><span class="w"> </span><span class="c1">// los datos que enviamos al servidor en el &#39;send&#39;</span>
<a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a><span class="w">  </span><span class="nx">headers</span><span class="o">:</span><span class="p">{</span>
<a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a><span class="w">    </span><span class="s1">&#39;Content-Type&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;application/json&#39;</span>
<a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a><span class="p">}).</span><span class="nx">then</span>
</code></pre></div>
<p>Ejemplo de una petición para añadir datos:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="nx">fetch</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="w">  </span><span class="nx">method</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;POST&#39;</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a><span class="w">  </span><span class="nx">body</span><span class="o">:</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">data</span><span class="p">),</span><span class="w"> </span><span class="c1">// los datos que enviamos al servidor en el &#39;send&#39;</span>
<a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a><span class="w">  </span><span class="nx">headers</span><span class="o">:</span><span class="p">{</span>
<a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a><span class="w">    </span><span class="s1">&#39;Content-Type&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;application/json&#39;</span>
<a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-26-7" name="__codelineno-26-7" href="#__codelineno-26-7"></a><span class="p">})</span>
<a id="__codelineno-26-8" name="__codelineno-26-8" href="#__codelineno-26-8"></a><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">response</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-26-9" name="__codelineno-26-9" href="#__codelineno-26-9"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">response</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-26-10" name="__codelineno-26-10" href="#__codelineno-26-10"></a><span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="sb">`Error </span><span class="si">${</span><span class="nx">response</span><span class="p">.</span><span class="nx">status</span><span class="si">}</span><span class="sb"> de la BBDD: </span><span class="si">${</span><span class="nx">response</span><span class="p">.</span><span class="nx">statusText</span><span class="si">}</span><span class="sb">`</span>
<a id="__codelineno-26-11" name="__codelineno-26-11" href="#__codelineno-26-11"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span>
<a id="__codelineno-26-12" name="__codelineno-26-12" href="#__codelineno-26-12"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">()</span>
<a id="__codelineno-26-13" name="__codelineno-26-13" href="#__codelineno-26-13"></a><span class="p">})</span>
<a id="__codelineno-26-14" name="__codelineno-26-14" href="#__codelineno-26-14"></a><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">datos</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-26-15" name="__codelineno-26-15" href="#__codelineno-26-15"></a><span class="w">  </span><span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;Datos recibidos&#39;</span><span class="p">)</span>
<a id="__codelineno-26-16" name="__codelineno-26-16" href="#__codelineno-26-16"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">datos</span><span class="p">)</span>
<a id="__codelineno-26-17" name="__codelineno-26-17" href="#__codelineno-26-17"></a><span class="p">})</span>
<a id="__codelineno-26-18" name="__codelineno-26-18" href="#__codelineno-26-18"></a><span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">err</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-26-19" name="__codelineno-26-19" href="#__codelineno-26-19"></a><span class="w">  </span><span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;Error en la petición HTTP: &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
<a id="__codelineno-26-20" name="__codelineno-26-20" href="#__codelineno-26-20"></a><span class="p">})</span>
</code></pre></div>
<p>Podéis ver mś ejemplos en <a href="https://developer.mozilla.org/es/docs/Web/API/Fetch_API/Utilizando_Fetch#Enviando_datos_JSON">MDN web docs</a> y otras páginas.</p>
<h3 id="peticiones-con-async-await">Peticiones con <em>async / await</em><a class="headerlink" href="#peticiones-con-async-await" title="Permanent link">&para;</a></h3>
<p>Estas nuevas instrucciones introducidas en ES2017 nos permiten escribir el código de peticiones asíncronas como si fueran síncronas lo que facilita su comprensión.</p>
<p>Se puede llamar a cualquier función asíncrona (por ejemplo una promesa como <em><code>fetch()</code></em>) anteponiendo la palabra <strong><code>await</code></strong> a la llamada. Esto provocará que la ejecución se "espere" a que se resuelva la promesa devuelta por esa función. Así nuestro código se asemeja a código síncrono ya que no continúan ejecutándose las instrucciones que hay después de un <em><code>await</code></em> hasta que esa petición se ha resuelto.</p>
<p>Cualquier función que realice un <em><code>await</code></em> pasa a ser asíncrona ya que no se ejecuta en ese momento sino que se espera un tiempo. Y para indicarlo debemos anteponer la palabra <strong><code>async</code></strong> a su declaración <em><code>function</code></em>. Al hacerlo automáticamente se "envuelve" esa función en una promesa (o sea que esa función pasa a devolver una promesa, a la que podríamos ponerle un <code>await</code> o un <code>.then()</code>).</p>
<p>Siguiendo con el ejemplo anterior:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">getUserPosts</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;https://jsonplaceholder.typicode.com/posts?userId=&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">idUser</span><span class="p">);</span>
<a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">response</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a><span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="sb">`Error </span><span class="si">${</span><span class="nx">response</span><span class="p">.</span><span class="nx">status</span><span class="si">}</span><span class="sb"> de la BBDD: </span><span class="si">${</span><span class="nx">response</span><span class="p">.</span><span class="nx">statusText</span><span class="si">}</span><span class="sb">`</span>
<a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">userPosts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span><span class="w"> </span><span class="c1">// recordad que .json() tb es una promesa</span>
<a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">userPosts</span><span class="p">;</span>
<a id="__codelineno-27-8" name="__codelineno-27-8" href="#__codelineno-27-8"></a><span class="p">}</span>
<a id="__codelineno-27-9" name="__codelineno-27-9" href="#__codelineno-27-9"></a><span class="p">...</span>
<a id="__codelineno-27-10" name="__codelineno-27-10" href="#__codelineno-27-10"></a><span class="c1">// Y llamaremos a esa función con</span>
<a id="__codelineno-27-11" name="__codelineno-27-11" href="#__codelineno-27-11"></a><span class="kd">const</span><span class="w"> </span><span class="nx">userPosts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">getUserPosts</span><span class="p">();</span>
</code></pre></div>
<h3 id="diferencia-entre-asyncawait-y-promesas">Diferencia entre <em>async/await</em> y <em>promesas</em><a class="headerlink" href="#diferencia-entre-asyncawait-y-promesas" title="Permanent link">&para;</a></h3>
<p>La diferencia entre usar <em><strong>async/await</strong></em> y <em><strong>promesas</strong></em> es que con <em>async/await</em> no tenemos que usar <code>.then()</code> para obtener el valor devuelto por la promesa sino que lo obtenemos directamente en la variable.</p>
<ul>
<li>
<p>Por ejemplo, si hacemos una petición <em><code>fetch</code></em> y queremos obtener los <em>posts</em> de un usuario con <code>id</code> <em><code>idUser</code></em> podemos hacerlo <strong>con <em>promesas</em></strong> así:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;https://jsonplaceholder.typicode.com/posts?userId=&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">idUser</span><span class="p">);</span>
</code></pre></div>
<p>y en <em><code>response</code></em> tendremos una promesa que se resolverá cuando llegue la respuesta del servidor. Para obtener los datos de la respuesta debemos suscribirnos a esa promesa con un <code>.then()</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="nx">response</span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">response</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">())</span>
</code></pre></div>
<p>y en el <em><code>then</code></em> tendremos los datos de la respuesta convertidos a un objeto o array. Si queremos obtenerlos en una variable debemos hacer:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="nx">response</span>
<a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="w">    </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">response</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">())</span>
<a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a><span class="w">    </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">data</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">userPosts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">data</span><span class="p">;</span>
<a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a><span class="w">        </span><span class="c1">// aquí ya podemos usar los datos</span>
<a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a><span class="w">    </span><span class="p">})</span>
</code></pre></div>
</li>
<li>
<p>Con <em>async/await</em> podemos hacer:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;https://jsonplaceholder.typicode.com/posts?userId=&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">idUser</span><span class="p">);</span>
<a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a><span class="kd">const</span><span class="w"> </span><span class="nx">userPosts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
<a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a><span class="c1">// aquí ya podemos usar los datos</span>
</code></pre></div>
<p>En este caso <em><code>response</code></em> es una promesa que se resolverá cuando llegue la respuesta del servidor y <em><code>userPosts</code></em> es una promesa que se resolverá cuando se conviertan los datos de la respuesta a un objeto o array. Pero como hemos puesto <em><code>await</code></em> lo que obtenemos en <em><code>response</code></em> es ya el valor devuelto por la promesa cuando se resuelve.</p>
<p>Con esto conseguimos que llamadas asíncronas se comporten como instrucciones síncronas lo que aporta claridad al código.</p>
</li>
</ul>
<p>Podéis ver algunos ejemplos del uso de <em>async / await</em> en la <a href="https://developer.mozilla.org/es/docs/Web/JavaScript/Referencia/Sentencias/funcion_asincrona">página de MDN</a>.</p>
<p>El ejemplo de los posts quedaría:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">main.js (usando async/await)</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-32-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-32-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-32-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-32-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-32-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-32-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-32-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-32-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-32-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-32-10">10</a></span>
<span class="normal"><a href="#__codelineno-32-11">11</a></span>
<span class="normal"><a href="#__codelineno-32-12">12</a></span>
<span class="normal"><a href="#__codelineno-32-13">13</a></span>
<span class="normal"><a href="#__codelineno-32-14">14</a></span>
<span class="normal"><a href="#__codelineno-32-15">15</a></span>
<span class="normal"><a href="#__codelineno-32-16">16</a></span>
<span class="normal"><a href="#__codelineno-32-17">17</a></span>
<span class="normal"><a href="#__codelineno-32-18">18</a></span>
<span class="normal"><a href="#__codelineno-32-19">19</a></span>
<span class="normal"><a href="#__codelineno-32-20">20</a></span>
<span class="normal"><a href="#__codelineno-32-21">21</a></span>
<span class="normal"><a href="#__codelineno-32-22">22</a></span>
<span class="normal"><a href="#__codelineno-32-23">23</a></span>
<span class="normal"><a href="#__codelineno-32-24">24</a></span>
<span class="normal"><a href="#__codelineno-32-25">25</a></span>
<span class="normal"><a href="#__codelineno-32-26">26</a></span>
<span class="normal"><a href="#__codelineno-32-27">27</a></span>
<span class="normal"><a href="#__codelineno-32-28">28</a></span>
<span class="normal"><a href="#__codelineno-32-29">29</a></span>
<span class="normal"><a href="#__codelineno-32-30">30</a></span>
<span class="normal"><a href="#__codelineno-32-31">31</a></span>
<span class="normal"><a href="#__codelineno-32-32">32</a></span>
<span class="normal"><a href="#__codelineno-32-33">33</a></span>
<span class="normal"><a href="#__codelineno-32-34">34</a></span>
<span class="normal"><a href="#__codelineno-32-35">35</a></span>
<span class="normal"><a href="#__codelineno-32-36">36</a></span>
<span class="normal"><a href="#__codelineno-32-37">37</a></span>
<span class="normal"><a href="#__codelineno-32-38">38</a></span>
<span class="normal"><a href="#__codelineno-32-39">39</a></span>
<span class="normal"><a href="#__codelineno-32-40">40</a></span>
<span class="normal"><a href="#__codelineno-32-41">41</a></span>
<span class="normal"><a href="#__codelineno-32-42">42</a></span>
<span class="normal"><a href="#__codelineno-32-43">43</a></span>
<span class="normal"><a href="#__codelineno-32-44">44</a></span>
<span class="normal"><a href="#__codelineno-32-45">45</a></span>
<span class="normal"><a href="#__codelineno-32-46">46</a></span>
<span class="normal"><a href="#__codelineno-32-47">47</a></span>
<span class="normal"><a href="#__codelineno-32-48">48</a></span>
<span class="normal"><a href="#__codelineno-32-49">49</a></span>
<span class="normal"><a href="#__codelineno-32-50">50</a></span>
<span class="normal"><a href="#__codelineno-32-51">51</a></span>
<span class="normal"><a href="#__codelineno-32-52">52</a></span>
<span class="normal"><a href="#__codelineno-32-53">53</a></span>
<span class="normal"><a href="#__codelineno-32-54">54</a></span>
<span class="normal"><a href="#__codelineno-32-55">55</a></span>
<span class="normal"><a href="#__codelineno-32-56">56</a></span>
<span class="normal"><a href="#__codelineno-32-57">57</a></span>
<span class="normal"><a href="#__codelineno-32-58">58</a></span>
<span class="normal"><a href="#__codelineno-32-59">59</a></span>
<span class="normal"><a href="#__codelineno-32-60">60</a></span>
<span class="normal"><a href="#__codelineno-32-61">61</a></span>
<span class="normal"><a href="#__codelineno-32-62">62</a></span>
<span class="normal"><a href="#__codelineno-32-63">63</a></span>
<span class="normal"><a href="#__codelineno-32-64">64</a></span>
<span class="normal"><a href="#__codelineno-32-65">65</a></span>
<span class="normal"><a href="#__codelineno-32-66">66</a></span>
<span class="normal"><a href="#__codelineno-32-67">67</a></span>
<span class="normal"><a href="#__codelineno-32-68">68</a></span>
<span class="normal"><a href="#__codelineno-32-69">69</a></span>
<span class="normal"><a href="#__codelineno-32-70">70</a></span>
<span class="normal"><a href="#__codelineno-32-71">71</a></span>
<span class="normal"><a href="#__codelineno-32-72">72</a></span>
<span class="normal"><a href="#__codelineno-32-73">73</a></span>
<span class="normal"><a href="#__codelineno-32-74">74</a></span>
<span class="normal"><a href="#__codelineno-32-75">75</a></span>
<span class="normal"><a href="#__codelineno-32-76">76</a></span>
<span class="normal"><a href="#__codelineno-32-77">77</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">SERVER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;https://jsonplaceholder.typicode.com&quot;</span><span class="p">;</span>
<a id="__codelineno-32-2" name="__codelineno-32-2"></a>
<a id="__codelineno-32-3" name="__codelineno-32-3"></a><span class="kd">const</span><span class="w"> </span><span class="nx">form</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;form-user-posts&quot;</span><span class="p">);</span>
<a id="__codelineno-32-4" name="__codelineno-32-4"></a><span class="kd">const</span><span class="w"> </span><span class="nx">errorMessage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;error-message&quot;</span><span class="p">);</span>
<a id="__codelineno-32-5" name="__codelineno-32-5"></a><span class="kd">const</span><span class="w"> </span><span class="nx">userPosts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;user-posts&quot;</span><span class="p">);</span>
<a id="__codelineno-32-6" name="__codelineno-32-6"></a><span class="kd">const</span><span class="w"> </span><span class="nx">postTbody</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">&quot;tbody&quot;</span><span class="p">);</span>
<a id="__codelineno-32-7" name="__codelineno-32-7"></a>
<a id="__codelineno-32-8" name="__codelineno-32-8"></a><span class="nx">hideError</span><span class="p">();</span>
<a id="__codelineno-32-9" name="__codelineno-32-9"></a><span class="nx">userPosts</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;none&quot;</span><span class="p">;</span>
<a id="__codelineno-32-10" name="__codelineno-32-10"></a>
<a id="__codelineno-32-11" name="__codelineno-32-11"></a><span class="hll"><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">getPosts</span><span class="p">(</span><span class="nx">idUser</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><a id="__codelineno-32-12" name="__codelineno-32-12"></a><span class="hll"><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="nx">SERVER</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot;/posts?userId=&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">idUser</span><span class="p">);</span>
</span><a id="__codelineno-32-13" name="__codelineno-32-13"></a><span class="hll"><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">response</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><a id="__codelineno-32-14" name="__codelineno-32-14"></a><span class="hll"><span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="sb">`Error </span><span class="si">${</span><span class="nx">response</span><span class="p">.</span><span class="nx">status</span><span class="si">}</span><span class="sb"> de la BBDD: </span><span class="si">${</span><span class="nx">response</span><span class="p">.</span><span class="nx">statusText</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
</span><a id="__codelineno-32-15" name="__codelineno-32-15"></a><span class="hll"><span class="w">  </span><span class="p">}</span>
</span><a id="__codelineno-32-16" name="__codelineno-32-16"></a><span class="hll"><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">posts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
</span><a id="__codelineno-32-17" name="__codelineno-32-17"></a><span class="hll"><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">posts</span><span class="p">;</span>
</span><a id="__codelineno-32-18" name="__codelineno-32-18"></a><span class="hll"><span class="p">}</span>
</span><a id="__codelineno-32-19" name="__codelineno-32-19"></a>
<a id="__codelineno-32-20" name="__codelineno-32-20"></a><span class="hll"><span class="nx">form</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;submit&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">event</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><a id="__codelineno-32-21" name="__codelineno-32-21"></a><span class="w">  </span><span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
<a id="__codelineno-32-22" name="__codelineno-32-22"></a>
<a id="__codelineno-32-23" name="__codelineno-32-23"></a><span class="w">  </span><span class="nx">userPosts</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;none&quot;</span><span class="p">;</span>
<a id="__codelineno-32-24" name="__codelineno-32-24"></a><span class="w">  </span><span class="nx">hideError</span><span class="p">();</span>
<a id="__codelineno-32-25" name="__codelineno-32-25"></a>
<a id="__codelineno-32-26" name="__codelineno-32-26"></a><span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="nx">inputIdUser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">[</span><span class="s2">&quot;user-id&quot;</span><span class="p">];</span>
<a id="__codelineno-32-27" name="__codelineno-32-27"></a><span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="nx">idUser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">inputIdUser</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
<a id="__codelineno-32-28" name="__codelineno-32-28"></a>
<a id="__codelineno-32-29" name="__codelineno-32-29"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">isNaN</span><span class="p">(</span><span class="nx">idUser</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">idUser</span><span class="p">.</span><span class="nx">trim</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-32-30" name="__codelineno-32-30"></a><span class="w">    </span><span class="nx">showError</span><span class="p">(</span><span class="s2">&quot;Debes introducir un número&quot;</span><span class="p">);</span>
<a id="__codelineno-32-31" name="__codelineno-32-31"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-32-32" name="__codelineno-32-32"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">posts</span><span class="p">;</span>
<a id="__codelineno-32-33" name="__codelineno-32-33"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-32-34" name="__codelineno-32-34"></a><span class="hll"><span class="w">      </span><span class="nx">posts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">getPosts</span><span class="p">(</span><span class="nx">idUser</span><span class="p">);</span>
</span><a id="__codelineno-32-35" name="__codelineno-32-35"></a><span class="w">      </span><span class="c1">// La ejecución se para en la sentencia anterior hasta que </span>
<a id="__codelineno-32-36" name="__codelineno-32-36"></a><span class="w">      </span><span class="c1">// contesta la función getPosts() y se asigna el valor a la variable posts</span>
<a id="__codelineno-32-37" name="__codelineno-32-37"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-32-38" name="__codelineno-32-38"></a><span class="w">      </span><span class="nx">showError</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
<a id="__codelineno-32-39" name="__codelineno-32-39"></a><span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
<a id="__codelineno-32-40" name="__codelineno-32-40"></a><span class="w">      </span><span class="k">return</span><span class="p">;</span>
<a id="__codelineno-32-41" name="__codelineno-32-41"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-32-42" name="__codelineno-32-42"></a>
<a id="__codelineno-32-43" name="__codelineno-32-43"></a><span class="w">    </span><span class="nx">postTbody</span><span class="p">.</span><span class="nx">innerHTML</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">;</span>
<a id="__codelineno-32-44" name="__codelineno-32-44"></a>
<a id="__codelineno-32-45" name="__codelineno-32-45"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">posts</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">posts</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-32-46" name="__codelineno-32-46"></a><span class="w">      </span><span class="nx">showError</span><span class="p">(</span><span class="s2">&quot;No hay posts para este usuario&quot;</span><span class="p">);</span>
<a id="__codelineno-32-47" name="__codelineno-32-47"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-32-48" name="__codelineno-32-48"></a><span class="w">      </span><span class="nx">posts</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">post</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-32-49" name="__codelineno-32-49"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">newPost</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;tr&quot;</span><span class="p">);</span>
<a id="__codelineno-32-50" name="__codelineno-32-50"></a><span class="w">        </span><span class="nx">newPost</span><span class="p">.</span><span class="nx">innerHTML</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`</span>
<a id="__codelineno-32-51" name="__codelineno-32-51"></a><span class="sb">                  &lt;td&gt;</span><span class="si">${</span><span class="nx">post</span><span class="p">.</span><span class="nx">userId</span><span class="si">}</span><span class="sb">&lt;/td&gt;</span>
<a id="__codelineno-32-52" name="__codelineno-32-52"></a><span class="sb">                  &lt;td&gt;</span><span class="si">${</span><span class="nx">post</span><span class="p">.</span><span class="nx">id</span><span class="si">}</span><span class="sb">&lt;/td&gt;</span>
<a id="__codelineno-32-53" name="__codelineno-32-53"></a><span class="sb">                  &lt;td&gt;</span><span class="si">${</span><span class="nx">post</span><span class="p">.</span><span class="nx">title</span><span class="si">}</span><span class="sb">&lt;/td&gt;</span>
<a id="__codelineno-32-54" name="__codelineno-32-54"></a><span class="sb">                  &lt;td&gt;</span><span class="si">${</span><span class="nx">post</span><span class="p">.</span><span class="nx">body</span><span class="si">}</span><span class="sb">&lt;/td&gt;`</span><span class="p">;</span>
<a id="__codelineno-32-55" name="__codelineno-32-55"></a><span class="w">        </span><span class="nx">postTbody</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">newPost</span><span class="p">);</span>
<a id="__codelineno-32-56" name="__codelineno-32-56"></a><span class="w">      </span><span class="p">});</span>
<a id="__codelineno-32-57" name="__codelineno-32-57"></a>
<a id="__codelineno-32-58" name="__codelineno-32-58"></a><span class="w">      </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;num-posts&quot;</span><span class="p">).</span><span class="nx">textContent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">posts</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
<a id="__codelineno-32-59" name="__codelineno-32-59"></a>
<a id="__codelineno-32-60" name="__codelineno-32-60"></a><span class="w">      </span><span class="nx">userPosts</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;block&quot;</span><span class="p">;</span>
<a id="__codelineno-32-61" name="__codelineno-32-61"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-32-62" name="__codelineno-32-62"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-32-63" name="__codelineno-32-63"></a>
<a id="__codelineno-32-64" name="__codelineno-32-64"></a><span class="w">  </span><span class="nx">inputIdUser</span><span class="p">.</span><span class="nx">focus</span><span class="p">();</span>
<a id="__codelineno-32-65" name="__codelineno-32-65"></a><span class="w">  </span><span class="nx">inputIdUser</span><span class="p">.</span><span class="nx">select</span><span class="p">();</span>
<a id="__codelineno-32-66" name="__codelineno-32-66"></a><span class="p">});</span>
<a id="__codelineno-32-67" name="__codelineno-32-67"></a>
<a id="__codelineno-32-68" name="__codelineno-32-68"></a><span class="kd">function</span><span class="w"> </span><span class="nx">showError</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-32-69" name="__codelineno-32-69"></a><span class="w">  </span><span class="nx">errorMessage</span><span class="p">.</span><span class="nx">textContent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">message</span><span class="p">;</span>
<a id="__codelineno-32-70" name="__codelineno-32-70"></a><span class="w">  </span><span class="nx">errorMessage</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;red&quot;</span><span class="p">;</span>
<a id="__codelineno-32-71" name="__codelineno-32-71"></a><span class="w">  </span><span class="nx">errorMessage</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;inline-block&quot;</span><span class="p">;</span>
<a id="__codelineno-32-72" name="__codelineno-32-72"></a><span class="p">}</span>
<a id="__codelineno-32-73" name="__codelineno-32-73"></a>
<a id="__codelineno-32-74" name="__codelineno-32-74"></a><span class="kd">function</span><span class="w"> </span><span class="nx">hideError</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-32-75" name="__codelineno-32-75"></a><span class="w">  </span><span class="nx">errorMessage</span><span class="p">.</span><span class="nx">textContent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">;</span>
<a id="__codelineno-32-76" name="__codelineno-32-76"></a><span class="w">  </span><span class="nx">errorMessage</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;none&quot;</span><span class="p">;</span>
<a id="__codelineno-32-77" name="__codelineno-32-77"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>En este código estamos tratando los posibles errores que se pueden producir. Con <em>async/await</em> los errores se tratan como en las excepciones, con <em><strong><code>try ... catch</code></strong></em>:</p>
<p>También podemos tratarlos sin usar <em><code>try...catch</code></em> porque como una función asíncrona devuelve una promesa podemos suscribirnos directamente a su <em><code>.catch()</code></em></p>
<h3 id="hacer-varias-peticiones-simultaneamente-promiseall">Hacer varias peticiones simultáneamente. <code>Promise.all()</code><a class="headerlink" href="#hacer-varias-peticiones-simultaneamente-promiseall" title="Permanent link">&para;</a></h3>
<p>En ocasiones necesitamos hacer más de una petición al servidor. Por ejemplo para obtener los productos y sus categorías podríamos hacer:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">peticiones separadas</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-33-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-33-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-33-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-33-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-33-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-33-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-33-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-33-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-33-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-33-10">10</a></span>
<span class="normal"><a href="#__codelineno-33-11">11</a></span>
<span class="normal"><a href="#__codelineno-33-12">12</a></span>
<span class="normal"><a href="#__codelineno-33-13">13</a></span>
<span class="normal"><a href="#__codelineno-33-14">14</a></span>
<span class="normal"><a href="#__codelineno-33-15">15</a></span>
<span class="normal"><a href="#__codelineno-33-16">16</a></span>
<span class="normal"><a href="#__codelineno-33-17">17</a></span>
<span class="normal"><a href="#__codelineno-33-18">18</a></span>
<span class="normal"><a href="#__codelineno-33-19">19</a></span>
<span class="normal"><a href="#__codelineno-33-20">20</a></span>
<span class="normal"><a href="#__codelineno-33-21">21</a></span>
<span class="normal"><a href="#__codelineno-33-22">22</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1"></a><span class="hll"><span class="kd">function</span><span class="w"> </span><span class="nx">getTable</span><span class="p">(</span><span class="nx">table</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><a id="__codelineno-33-2" name="__codelineno-33-2"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span><span class="w"> </span><span class="nx">reject</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-33-3" name="__codelineno-33-3"></a><span class="w">    </span><span class="nx">fetch</span><span class="p">(</span><span class="nx">SERVER</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">table</span><span class="p">)</span>
<a id="__codelineno-33-4" name="__codelineno-33-4"></a><span class="w">      </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">response</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-33-5" name="__codelineno-33-5"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">response</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-33-6" name="__codelineno-33-6"></a><span class="w">          </span><span class="k">throw</span><span class="w"> </span><span class="sb">`Error </span><span class="si">${</span><span class="nx">response</span><span class="p">.</span><span class="nx">status</span><span class="si">}</span><span class="sb"> de la BBDD: </span><span class="si">${</span><span class="nx">response</span><span class="p">.</span><span class="nx">statusText</span><span class="si">}</span><span class="sb">`</span>
<a id="__codelineno-33-7" name="__codelineno-33-7"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span>
<a id="__codelineno-33-8" name="__codelineno-33-8"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">()</span>
<a id="__codelineno-33-9" name="__codelineno-33-9"></a><span class="w">      </span><span class="p">})</span>
<a id="__codelineno-33-10" name="__codelineno-33-10"></a><span class="w">      </span><span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">data</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">resolve</span><span class="p">(</span><span class="nx">data</span><span class="p">))</span>
<a id="__codelineno-33-11" name="__codelineno-33-11"></a><span class="w">      </span><span class="p">.</span><span class="k">catch</span><span class="p">((</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">reject</span><span class="p">(</span><span class="nx">error</span><span class="p">))</span>
<a id="__codelineno-33-12" name="__codelineno-33-12"></a><span class="w">  </span><span class="p">})</span>
<a id="__codelineno-33-13" name="__codelineno-33-13"></a><span class="p">}</span>
<a id="__codelineno-33-14" name="__codelineno-33-14"></a>
<a id="__codelineno-33-15" name="__codelineno-33-15"></a><span class="kd">function</span><span class="w"> </span><span class="nx">getData</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-33-16" name="__codelineno-33-16"></a><span class="hll"><span class="w">  </span><span class="nx">getTable</span><span class="p">(</span><span class="s1">&#39;/categories&#39;</span><span class="p">)</span>
</span><a id="__codelineno-33-17" name="__codelineno-33-17"></a><span class="w">    </span><span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">categories</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">categories</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">category</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">renderCategory</span><span class="p">(</span><span class="nx">category</span><span class="p">)))</span>
<a id="__codelineno-33-18" name="__codelineno-33-18"></a><span class="w">    </span><span class="p">.</span><span class="k">catch</span><span class="p">((</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">renderErrorMessage</span><span class="p">(</span><span class="nx">error</span><span class="p">))</span>
<a id="__codelineno-33-19" name="__codelineno-33-19"></a><span class="hll"><span class="w">  </span><span class="nx">getTable</span><span class="p">(</span><span class="s1">&#39;/products&#39;</span><span class="p">)</span>
</span><a id="__codelineno-33-20" name="__codelineno-33-20"></a><span class="w">    </span><span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">products</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">products</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">product</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">renderProduct</span><span class="p">(</span><span class="nx">product</span><span class="p">)))</span>
<a id="__codelineno-33-21" name="__codelineno-33-21"></a><span class="w">    </span><span class="p">.</span><span class="k">catch</span><span class="p">((</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">renderErrorMessage</span><span class="p">(</span><span class="nx">error</span><span class="p">))</span>
<a id="__codelineno-33-22" name="__codelineno-33-22"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Pero si para renderizar los productos necesitamos tener las categorías este código no nos lo garantiza ya que el servidor podría devolver antes los productos aunque los pedimos después.</p>
<p>Una solución sería no pedir los productos hasta tener las categorías:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">encadenar peticiones</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-34-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-34-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-34-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-34-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-34-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-34-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-34-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-34-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-34-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-34-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1"></a><span class="kd">function</span><span class="w"> </span><span class="nx">getData</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-34-2" name="__codelineno-34-2"></a><span class="hll"><span class="w">  </span><span class="nx">getTable</span><span class="p">(</span><span class="s1">&#39;/categories&#39;</span><span class="p">)</span>
</span><a id="__codelineno-34-3" name="__codelineno-34-3"></a><span class="w">    </span><span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">categories</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-34-4" name="__codelineno-34-4"></a><span class="w">      </span><span class="nx">categories</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">category</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">renderCategory</span><span class="p">(</span><span class="nx">category</span><span class="p">))</span>
<a id="__codelineno-34-5" name="__codelineno-34-5"></a><span class="hll"><span class="w">      </span><span class="nx">getTable</span><span class="p">(</span><span class="s1">&#39;/products&#39;</span><span class="p">)</span>
</span><a id="__codelineno-34-6" name="__codelineno-34-6"></a><span class="w">        </span><span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">products</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">products</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">product</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">renderProduct</span><span class="p">(</span><span class="nx">product</span><span class="p">)))</span>
<a id="__codelineno-34-7" name="__codelineno-34-7"></a><span class="w">        </span><span class="p">.</span><span class="k">catch</span><span class="p">((</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">renderErrorMessage</span><span class="p">(</span><span class="nx">error</span><span class="p">))</span>
<a id="__codelineno-34-8" name="__codelineno-34-8"></a><span class="w">    </span><span class="p">})</span>
<a id="__codelineno-34-9" name="__codelineno-34-9"></a><span class="w">    </span><span class="p">.</span><span class="k">catch</span><span class="p">((</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">renderErrorMessage</span><span class="p">(</span><span class="nx">error</span><span class="p">))</span>
<a id="__codelineno-34-10" name="__codelineno-34-10"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>pero <strong>esto hará más lento nuestro código al no hacer las dos peticiones simultáneamente</strong>.</p>
<p>La solución es usar el método <strong><code>Promise.all()</code></strong> al que se le pasa un array de promesas a hacer y devuelve una promesa que:</p>
<ul>
<li><strong>se resuelve</strong> en el momento en que <strong>todas las promesas se han resuelto</strong> satisfactoriamente o</li>
<li><strong>se rechaza</strong> en el momento en que <strong>alguna de las promesas es rechazada</strong></li>
</ul>
<p>El código anterior de forma correcta sería:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Promise.all()</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-35-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-35-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-35-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-35-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-35-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-35-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-35-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-35-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-35-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-35-10">10</a></span>
<span class="normal"><a href="#__codelineno-35-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1"></a><span class="kd">function</span><span class="w"> </span><span class="nx">getData</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-35-2" name="__codelineno-35-2"></a><span class="hll"><span class="w">  </span><span class="nb">Promise</span><span class="p">.</span><span class="nx">all</span><span class="p">([</span>
</span><a id="__codelineno-35-3" name="__codelineno-35-3"></a><span class="w">    </span><span class="nx">getTable</span><span class="p">(</span><span class="s1">&#39;/categories&#39;</span><span class="p">)</span>
<a id="__codelineno-35-4" name="__codelineno-35-4"></a><span class="w">    </span><span class="nx">getTable</span><span class="p">(</span><span class="s1">&#39;/products&#39;</span><span class="p">)</span>
<a id="__codelineno-35-5" name="__codelineno-35-5"></a><span class="w">  </span><span class="p">])</span>
<a id="__codelineno-35-6" name="__codelineno-35-6"></a><span class="w">  </span><span class="p">.</span><span class="nx">then</span><span class="p">(([</span><span class="nx">categories</span><span class="p">,</span><span class="w"> </span><span class="nx">products</span><span class="p">])</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-35-7" name="__codelineno-35-7"></a><span class="w">    </span><span class="nx">categories</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">category</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">renderCategory</span><span class="p">(</span><span class="nx">category</span><span class="p">))</span>
<a id="__codelineno-35-8" name="__codelineno-35-8"></a><span class="w">    </span><span class="nx">products</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">product</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">renderProduct</span><span class="p">(</span><span class="nx">product</span><span class="p">))</span>
<a id="__codelineno-35-9" name="__codelineno-35-9"></a><span class="w">  </span><span class="p">})</span>
<a id="__codelineno-35-10" name="__codelineno-35-10"></a><span class="w">  </span><span class="p">.</span><span class="k">catch</span><span class="p">((</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">renderErrorMessage</span><span class="p">(</span><span class="nx">error</span><span class="p">))</span>
<a id="__codelineno-35-11" name="__codelineno-35-11"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Lo mismo pasa si en vez de promesas usamos <em>async/await</em>. Si hacemos:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">async/await en peticiones separadas</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-36-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-36-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-36-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-36-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-36-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-36-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-36-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-36-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-36-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-36-10">10</a></span>
<span class="normal"><a href="#__codelineno-36-11">11</a></span>
<span class="normal"><a href="#__codelineno-36-12">12</a></span>
<span class="normal"><a href="#__codelineno-36-13">13</a></span>
<span class="normal"><a href="#__codelineno-36-14">14</a></span>
<span class="normal"><a href="#__codelineno-36-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1"></a><span class="hll"><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">getTable</span><span class="p">(</span><span class="nx">table</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><a id="__codelineno-36-2" name="__codelineno-36-2"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="nx">SERVER</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">table</span><span class="p">)</span>
<a id="__codelineno-36-3" name="__codelineno-36-3"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">response</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-36-4" name="__codelineno-36-4"></a><span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="sb">`Error </span><span class="si">${</span><span class="nx">response</span><span class="p">.</span><span class="nx">status</span><span class="si">}</span><span class="sb"> de la BBDD: </span><span class="si">${</span><span class="nx">response</span><span class="p">.</span><span class="nx">statusText</span><span class="si">}</span><span class="sb">`</span>
<a id="__codelineno-36-5" name="__codelineno-36-5"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-36-6" name="__codelineno-36-6"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">()</span>
<a id="__codelineno-36-7" name="__codelineno-36-7"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">data</span>
<a id="__codelineno-36-8" name="__codelineno-36-8"></a><span class="p">}</span>
<a id="__codelineno-36-9" name="__codelineno-36-9"></a>
<a id="__codelineno-36-10" name="__codelineno-36-10"></a><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">getData</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-36-11" name="__codelineno-36-11"></a><span class="hll"><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">responseCategories</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">getTable</span><span class="p">(</span><span class="s1">&#39;/categories&#39;</span><span class="p">);</span>
</span><a id="__codelineno-36-12" name="__codelineno-36-12"></a><span class="hll"><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">responseProducts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">getTable</span><span class="p">(</span><span class="s1">&#39;/products&#39;</span><span class="p">);</span>
</span><a id="__codelineno-36-13" name="__codelineno-36-13"></a><span class="w">  </span><span class="nx">categories</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">category</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">renderCategory</span><span class="p">(</span><span class="nx">category</span><span class="p">))</span>
<a id="__codelineno-36-14" name="__codelineno-36-14"></a><span class="w">  </span><span class="nx">products</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">product</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">renderProduct</span><span class="p">(</span><span class="nx">product</span><span class="p">))</span>
<a id="__codelineno-36-15" name="__codelineno-36-15"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>tenemos el problema de que no comienza la petición de los productos hasta que se reciben las categorías.</p>
<p>La solución con <code>Promise.all()</code> sería:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Promise.all() con async/await</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-37-1">1</a></span>
<span class="normal"><a href="#__codelineno-37-2">2</a></span>
<span class="normal"><a href="#__codelineno-37-3">3</a></span>
<span class="normal"><a href="#__codelineno-37-4">4</a></span>
<span class="normal"><a href="#__codelineno-37-5">5</a></span>
<span class="normal"><a href="#__codelineno-37-6">6</a></span>
<span class="normal"><a href="#__codelineno-37-7">7</a></span>
<span class="normal"><a href="#__codelineno-37-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1"></a><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">getData</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-37-2" name="__codelineno-37-2"></a><span class="hll"><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">categories</span><span class="p">,</span><span class="w"> </span><span class="nx">products</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nb">Promise</span><span class="p">.</span><span class="nx">all</span><span class="p">([</span>
</span><a id="__codelineno-37-3" name="__codelineno-37-3"></a><span class="w">    </span><span class="nx">getTable</span><span class="p">(</span><span class="s1">&#39;/categories&#39;</span><span class="p">)</span>
<a id="__codelineno-37-4" name="__codelineno-37-4"></a><span class="w">    </span><span class="nx">getTable</span><span class="p">(</span><span class="s1">&#39;/products&#39;</span><span class="p">)</span>
<a id="__codelineno-37-5" name="__codelineno-37-5"></a><span class="w">  </span><span class="p">])</span>
<a id="__codelineno-37-6" name="__codelineno-37-6"></a><span class="w">  </span><span class="nx">categories</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">category</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">renderCategory</span><span class="p">(</span><span class="nx">category</span><span class="p">))</span>
<a id="__codelineno-37-7" name="__codelineno-37-7"></a><span class="w">  </span><span class="nx">products</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">product</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">renderProduct</span><span class="p">(</span><span class="nx">product</span><span class="p">))</span>
<a id="__codelineno-37-8" name="__codelineno-37-8"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h2 id="realizar-peticiones-ajax">Realizar peticiones Ajax<a class="headerlink" href="#realizar-peticiones-ajax" title="Permanent link">&para;</a></h2>
<h3 id="json-server">Json Server<a class="headerlink" href="#json-server" title="Permanent link">&para;</a></h3>
<p>Las peticiones Ajax se hacen a un servidor que proporcione una API. Como ahora no tenemos ninguno podemos utilizar <em><strong>Json Server</strong></em> que es un servidor <strong>API-REST</strong> que funciona bajo <em>Node.js</em> (que ya tenemos instalado para usar NPM) y que utiliza un fichero <em>JSON</em> como contenedor de los datos en lugar de una base de datos.</p>
<p>Para instalarlo en nuestra máquina (lo instalaremos global para poderlo usar en todas nuestras prácticas) ejecutamos:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a>npm<span class="w"> </span>install<span class="w"> </span>-D<span class="w"> </span>json-server
</code></pre></div>
<p>Para que sirva un fichero <code>datos.json</code>, dentro del fichero <code>package.json</code> añadimos la línea:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="nt">&quot;scripts&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a><span class="w">  </span><span class="err">...</span>
<a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a><span class="hll"><span class="w">  </span><span class="nt">&quot;server&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;json-server datos.json&quot;</span>
</span><a id="__codelineno-39-4" name="__codelineno-39-4" href="#__codelineno-39-4"></a><span class="w">  </span><span class="err">...</span>
<a id="__codelineno-39-5" name="__codelineno-39-5" href="#__codelineno-39-5"></a><span class="p">}</span>
</code></pre></div>
<p>Le podemos poner la opción <em><code>--watch</code></em> ( o <code>-w</code>) para que actualice los datos si se modifica el fichero <em><code>.json</code></em> externamente (si lo editamos).</p>
<p>El fichero <em><code>datos.json</code></em> será un fichero que contenga un objeto JSON con una propiedad para cada "<em>tabla</em>" de nuestra BBDD. Por ejemplo, si queremos simular una BBDD con las tablas <em><code>users</code></em> y <em><code>posts</code></em> vacías el contenido del fichero será:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="p">{</span>
<a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a><span class="w">  </span><span class="nt">&quot;users&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span>
<a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a><span class="w">  </span><span class="nt">&quot;posts&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span>
<a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a><span class="p">}</span>
</code></pre></div>
<p>La API escucha en el puerto <code>3000</code> y servirá los diferentes objetos definidos en el fichero <em>.json</em>. Por ejemplo:</p>
<ul>
<li>http://localhost:3000/users: devuelve un array con todos los elementos de la tabla <em>users</em> del fichero <em>.json</em></li>
<li>http://localhost:3000/users/5: devuelve un objeto con el elemento de la tabla <em>users</em> cuya propiedad <em>id</em> valga 5</li>
</ul>
<p>También pueden hacerse peticiones más complejas como:</p>
<ul>
<li>http://localhost:3000/users?rol=3: devuelve un array con todos los elementos de <em>users</em> cuya propiedad <em>rol</em> valga 3</li>
</ul>
<p>Para más información: <a href="https://github.com/typicode/json-server">https://github.com/typicode/json-server</a>.</p>
<p>Si queremos acceder a la API desde otro equipo (no desde <em>localhost</em>) tenemos que indicar la IP de la máquina que ejecuta <em>json-server</em> y que se usará para acceder, por ejemplo si vamos a ejecutarlo en la máquina 192.168.0.10 pondremos:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a>json-server<span class="w"> </span>--host<span class="w"> </span><span class="m">192</span>.168.0.10<span class="w"> </span>datos.json<span class="w"> </span>
</code></pre></div>
<p>Y la ruta para acceder a la API sería <code>http://192.168.0.10:3000</code>.</p>
<div class="admonition note">
<p class="admonition-title">liveServer</p>
<p>Si utilizamos <code>liveServer</code> en <em>vsCode</em>, cada vez que se actualice el fichero <code>datos.json</code> recargará la página, ignorando el <code>.preventDefault()</code> del formulario. Para evitarlo podemos desactivar la recarga automática de liveServer añadiendo la siguiente línea al fichero <code>.vscode/settings.json</code> de <em>vsCode</em>:</p>
<div class="highlight"><span class="filename">.vscode/settings.json</span><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="p">{</span>
<a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a><span class="w">    </span><span class="nt">&quot;liveServer.settings.ignoreFiles&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a><span class="w">            </span><span class="s2">&quot;**/*.json&quot;</span><span class="p">,</span>
<a id="__codelineno-42-4" name="__codelineno-42-4" href="#__codelineno-42-4"></a><span class="w">            </span><span class="s2">&quot;.vscode/**&quot;</span><span class="p">,</span>
<a id="__codelineno-42-5" name="__codelineno-42-5" href="#__codelineno-42-5"></a><span class="w">            </span><span class="s2">&quot;**/*.scss&quot;</span><span class="p">,</span>
<a id="__codelineno-42-6" name="__codelineno-42-6" href="#__codelineno-42-6"></a><span class="w">            </span><span class="s2">&quot;**/*.sass&quot;</span><span class="p">,</span>
<a id="__codelineno-42-7" name="__codelineno-42-7" href="#__codelineno-42-7"></a><span class="w">            </span><span class="s2">&quot;**/*.ts&quot;</span>
<a id="__codelineno-42-8" name="__codelineno-42-8" href="#__codelineno-42-8"></a><span class="w">    </span><span class="p">]</span>
<a id="__codelineno-42-9" name="__codelineno-42-9" href="#__codelineno-42-9"></a><span class="p">}</span>
</code></pre></div>
</div>
<h3 id="rest-client">REST client<a class="headerlink" href="#rest-client" title="Permanent link">&para;</a></h3>
<p>Para probar las peticiones <code>GET</code> podemos poner la URL en la barra de direcciones del navegador pero para probar el resto de peticiones debemos instalar en nuestro navegador una extensión que nos permita realizar las peticiones indicando el método a usar, las cabeceras a enviar y los datos que enviaremos a servidor, además de la URL.</p>
<p>Existen multitud de aplicaciones para realizar peticiones HTTP, como <a href="https://install.advancedrestclient.com/install">Advanced REST client</a>. Cada navegador tiene sus propias extensiones para hacer esto, como <a href="https://chrome.google.com/webstore/detail/advanced-rest-client/hgmloofddffdnphfgcellkdfbfbjeloo?hl=es"><em>Advanced Rest Client</em></a> para Chrome o <a href="https://addons.mozilla.org/es/firefox/addon/restclient/"><em>RestClient</em></a> para Firefox.</p>
<h2 id="ejemplos-de-envio-de-datos">Ejemplos de envío de datos<a class="headerlink" href="#ejemplos-de-envio-de-datos" title="Permanent link">&para;</a></h2>
<p>Para poder añadir datos a la BBDD necesitamos hacer peticiones <code>POST</code> al servidor.</p>
<p>Vamos a ver un ejemplo de creación de un nuevo usuario. Supondremos que tenemos una página con un formulario para dar de alta nuevos usuarios:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">index.html</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-43-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-43-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-43-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-43-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-43-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-43-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-43-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-43-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-43-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-43-10">10</a></span>
<span class="normal"><a href="#__codelineno-43-11">11</a></span>
<span class="normal"><a href="#__codelineno-43-12">12</a></span>
<span class="normal"><a href="#__codelineno-43-13">13</a></span>
<span class="normal"><a href="#__codelineno-43-14">14</a></span>
<span class="normal"><a href="#__codelineno-43-15">15</a></span>
<span class="normal"><a href="#__codelineno-43-16">16</a></span>
<span class="normal"><a href="#__codelineno-43-17">17</a></span>
<span class="normal"><a href="#__codelineno-43-18">18</a></span>
<span class="normal"><a href="#__codelineno-43-19">19</a></span>
<span class="normal"><a href="#__codelineno-43-20">20</a></span>
<span class="normal"><a href="#__codelineno-43-21">21</a></span>
<span class="normal"><a href="#__codelineno-43-22">22</a></span>
<span class="normal"><a href="#__codelineno-43-23">23</a></span>
<span class="normal"><a href="#__codelineno-43-24">24</a></span>
<span class="normal"><a href="#__codelineno-43-25">25</a></span>
<span class="normal"><a href="#__codelineno-43-26">26</a></span>
<span class="normal"><a href="#__codelineno-43-27">27</a></span>
<span class="normal"><a href="#__codelineno-43-28">28</a></span>
<span class="normal"><a href="#__codelineno-43-29">29</a></span>
<span class="normal"><a href="#__codelineno-43-30">30</a></span>
<span class="normal"><a href="#__codelineno-43-31">31</a></span>
<span class="normal"><a href="#__codelineno-43-32">32</a></span>
<span class="normal"><a href="#__codelineno-43-33">33</a></span>
<span class="normal"><a href="#__codelineno-43-34">34</a></span>
<span class="normal"><a href="#__codelineno-43-35">35</a></span>
<span class="normal"><a href="#__codelineno-43-36">36</a></span>
<span class="normal"><a href="#__codelineno-43-37">37</a></span>
<span class="normal"><a href="#__codelineno-43-38">38</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1"></a><span class="cp">&lt;!DOCTYPE html&gt;</span>
<a id="__codelineno-43-2" name="__codelineno-43-2"></a><span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&quot;en&quot;</span><span class="p">&gt;</span>
<a id="__codelineno-43-3" name="__codelineno-43-3"></a><span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
<a id="__codelineno-43-4" name="__codelineno-43-4"></a>  <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="p">&gt;</span>
<a id="__codelineno-43-5" name="__codelineno-43-5"></a>  <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;viewport&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;width=device-width, initial-scale=1.0&quot;</span><span class="p">&gt;</span>
<a id="__codelineno-43-6" name="__codelineno-43-6"></a>  <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Crear usuario con POST<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<a id="__codelineno-43-7" name="__codelineno-43-7"></a>  <span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;module&quot;</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;main.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<a id="__codelineno-43-8" name="__codelineno-43-8"></a><span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<a id="__codelineno-43-9" name="__codelineno-43-9"></a>
<a id="__codelineno-43-10" name="__codelineno-43-10"></a><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
<a id="__codelineno-43-11" name="__codelineno-43-11"></a>
<a id="__codelineno-43-12" name="__codelineno-43-12"></a>  <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Crear usuario con POST<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<a id="__codelineno-43-13" name="__codelineno-43-13"></a>
<a id="__codelineno-43-14" name="__codelineno-43-14"></a>  <span class="cm">&lt;!-- FORMULARIO para introducir los datos del usuario --&gt;</span>
<a id="__codelineno-43-15" name="__codelineno-43-15"></a>
<a id="__codelineno-43-16" name="__codelineno-43-16"></a>  <span class="p">&lt;</span><span class="nt">form</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;create-user&quot;</span><span class="p">&gt;</span>
<a id="__codelineno-43-17" name="__codelineno-43-17"></a>    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<a id="__codelineno-43-18" name="__codelineno-43-18"></a>      <span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;name&quot;</span><span class="p">&gt;</span>Nombre: <span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
<a id="__codelineno-43-19" name="__codelineno-43-19"></a>      <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span>
<a id="__codelineno-43-20" name="__codelineno-43-20"></a>             <span class="na">name</span><span class="o">=</span><span class="s">&quot;name&quot;</span>
<a id="__codelineno-43-21" name="__codelineno-43-21"></a>             <span class="na">id</span><span class="o">=</span><span class="s">&quot;name&quot;</span> <span class="na">required</span><span class="p">&gt;</span>
<a id="__codelineno-43-22" name="__codelineno-43-22"></a>    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<a id="__codelineno-43-23" name="__codelineno-43-23"></a>    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<a id="__codelineno-43-24" name="__codelineno-43-24"></a>      <span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;email&quot;</span><span class="p">&gt;</span>Email: <span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
<a id="__codelineno-43-25" name="__codelineno-43-25"></a>      <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span>
<a id="__codelineno-43-26" name="__codelineno-43-26"></a>             <span class="na">name</span><span class="o">=</span><span class="s">&quot;email&quot;</span>
<a id="__codelineno-43-27" name="__codelineno-43-27"></a>             <span class="na">id</span><span class="o">=</span><span class="s">&quot;email&quot;</span>
<a id="__codelineno-43-28" name="__codelineno-43-28"></a>             <span class="na">required</span><span class="p">&gt;</span>
<a id="__codelineno-43-29" name="__codelineno-43-29"></a>    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<a id="__codelineno-43-30" name="__codelineno-43-30"></a>
<a id="__codelineno-43-31" name="__codelineno-43-31"></a>    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;Añadir usuario&quot;</span><span class="p">&gt;</span>
<a id="__codelineno-43-32" name="__codelineno-43-32"></a>  <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
<a id="__codelineno-43-33" name="__codelineno-43-33"></a>
<a id="__codelineno-43-34" name="__codelineno-43-34"></a>  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;users&quot;</span><span class="p">&gt;</span>
<a id="__codelineno-43-35" name="__codelineno-43-35"></a>    <span class="cm">&lt;!-- Aquí se mostrará la lista de usuarios --&gt;</span>
<a id="__codelineno-43-36" name="__codelineno-43-36"></a>  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<a id="__codelineno-43-37" name="__codelineno-43-37"></a><span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<a id="__codelineno-43-38" name="__codelineno-43-38"></a><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div></td></tr></table></div>
<p>En este ejemplo se usa el método <em><code>fetch()</code></em> para hacer la petición <code>POST</code> al servidor. En el objeto de opciones que le pasamos como segundo parámetro indicamos:</p>
<ul>
<li><strong><code>method: 'POST'</code></strong>: para indicar que es una petición <code>POST</code></li>
<li><strong><code>body: JSON.stringify(userData)</code></strong>: para convertir el objeto <em><code>userData</code></em> en una cadena de texto JSON que se enviará en el cuerpo de la petición</li>
<li><strong><code>headers: { 'Content-type': 'application/json' }</code></strong>: para indicar que el formato en el que se envía la información es JSON</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">main.js</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-44-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-44-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-44-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-44-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-44-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-44-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-44-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-44-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-44-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-44-10">10</a></span>
<span class="normal"><a href="#__codelineno-44-11">11</a></span>
<span class="normal"><a href="#__codelineno-44-12">12</a></span>
<span class="normal"><a href="#__codelineno-44-13">13</a></span>
<span class="normal"><a href="#__codelineno-44-14">14</a></span>
<span class="normal"><a href="#__codelineno-44-15">15</a></span>
<span class="normal"><a href="#__codelineno-44-16">16</a></span>
<span class="normal"><a href="#__codelineno-44-17">17</a></span>
<span class="normal"><a href="#__codelineno-44-18">18</a></span>
<span class="normal"><a href="#__codelineno-44-19">19</a></span>
<span class="normal"><a href="#__codelineno-44-20">20</a></span>
<span class="normal"><a href="#__codelineno-44-21">21</a></span>
<span class="normal"><a href="#__codelineno-44-22">22</a></span>
<span class="normal"><a href="#__codelineno-44-23">23</a></span>
<span class="normal"><a href="#__codelineno-44-24">24</a></span>
<span class="normal"><a href="#__codelineno-44-25">25</a></span>
<span class="normal"><a href="#__codelineno-44-26">26</a></span>
<span class="normal"><a href="#__codelineno-44-27">27</a></span>
<span class="normal"><a href="#__codelineno-44-28">28</a></span>
<span class="normal"><a href="#__codelineno-44-29">29</a></span>
<span class="normal"><a href="#__codelineno-44-30">30</a></span>
<span class="normal"><a href="#__codelineno-44-31">31</a></span>
<span class="normal"><a href="#__codelineno-44-32">32</a></span>
<span class="normal"><a href="#__codelineno-44-33">33</a></span>
<span class="normal"><a href="#__codelineno-44-34">34</a></span>
<span class="normal"><a href="#__codelineno-44-35">35</a></span>
<span class="normal"><a href="#__codelineno-44-36">36</a></span>
<span class="normal"><a href="#__codelineno-44-37">37</a></span>
<span class="normal"><a href="#__codelineno-44-38">38</a></span>
<span class="normal"><a href="#__codelineno-44-39">39</a></span>
<span class="normal"><a href="#__codelineno-44-40">40</a></span>
<span class="normal"><a href="#__codelineno-44-41">41</a></span>
<span class="normal"><a href="#__codelineno-44-42">42</a></span>
<span class="normal"><a href="#__codelineno-44-43">43</a></span>
<span class="normal"><a href="#__codelineno-44-44">44</a></span>
<span class="normal"><a href="#__codelineno-44-45">45</a></span>
<span class="normal"><a href="#__codelineno-44-46">46</a></span>
<span class="normal"><a href="#__codelineno-44-47">47</a></span>
<span class="normal"><a href="#__codelineno-44-48">48</a></span>
<span class="normal"><a href="#__codelineno-44-49">49</a></span>
<span class="normal"><a href="#__codelineno-44-50">50</a></span>
<span class="normal"><a href="#__codelineno-44-51">51</a></span>
<span class="normal"><a href="#__codelineno-44-52">52</a></span>
<span class="normal"><a href="#__codelineno-44-53">53</a></span>
<span class="normal"><a href="#__codelineno-44-54">54</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">form</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;create-user&quot;</span><span class="p">);</span>
<a id="__codelineno-44-2" name="__codelineno-44-2"></a>
<a id="__codelineno-44-3" name="__codelineno-44-3"></a><span class="nx">form</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;submit&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">event</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-44-4" name="__codelineno-44-4"></a><span class="w">  </span><span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
<a id="__codelineno-44-5" name="__codelineno-44-5"></a>
<a id="__codelineno-44-6" name="__codelineno-44-6"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">userData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-44-7" name="__codelineno-44-7"></a><span class="w">    </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">).</span><span class="nx">value</span><span class="p">,</span>
<a id="__codelineno-44-8" name="__codelineno-44-8"></a><span class="w">    </span><span class="nx">email</span><span class="o">:</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;email&quot;</span><span class="p">).</span><span class="nx">value</span><span class="p">,</span>
<a id="__codelineno-44-9" name="__codelineno-44-9"></a><span class="w">  </span><span class="p">};</span>
<a id="__codelineno-44-10" name="__codelineno-44-10"></a>
<a id="__codelineno-44-11" name="__codelineno-44-11"></a><span class="w">  </span><span class="nx">createUser</span><span class="p">(</span><span class="nx">userData</span><span class="p">);</span>
<a id="__codelineno-44-12" name="__codelineno-44-12"></a><span class="p">});</span>
<a id="__codelineno-44-13" name="__codelineno-44-13"></a>
<a id="__codelineno-44-14" name="__codelineno-44-14"></a><span class="kd">function</span><span class="w"> </span><span class="nx">createUser</span><span class="p">(</span><span class="nx">userData</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-44-15" name="__codelineno-44-15"></a><span class="w">  </span><span class="nx">fetch</span><span class="p">(</span><span class="s2">&quot;http://localhost:3000/users&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-44-16" name="__codelineno-44-16"></a><span class="w">    </span><span class="c1">// Tipo de petición</span>
<a id="__codelineno-44-17" name="__codelineno-44-17"></a><span class="w">    </span><span class="nx">method</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;POST&quot;</span><span class="p">,</span>
<a id="__codelineno-44-18" name="__codelineno-44-18"></a><span class="w">    </span><span class="c1">// Convertir el objeto a una cadena de texto JSON para enviarlo en el cuerpo de la petición</span>
<a id="__codelineno-44-19" name="__codelineno-44-19"></a><span class="w">    </span><span class="nx">body</span><span class="o">:</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">userData</span><span class="p">),</span>
<a id="__codelineno-44-20" name="__codelineno-44-20"></a><span class="w">    </span><span class="c1">// En Content-type indicamos el formato en el que se envía la información</span>
<a id="__codelineno-44-21" name="__codelineno-44-21"></a><span class="w">    </span><span class="nx">headers</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-44-22" name="__codelineno-44-22"></a><span class="w">      </span><span class="s2">&quot;Content-type&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
<a id="__codelineno-44-23" name="__codelineno-44-23"></a><span class="w">    </span><span class="p">},</span>
<a id="__codelineno-44-24" name="__codelineno-44-24"></a><span class="w">  </span><span class="p">})</span>
<a id="__codelineno-44-25" name="__codelineno-44-25"></a><span class="w">    </span><span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">response</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">())</span>
<a id="__codelineno-44-26" name="__codelineno-44-26"></a><span class="w">    </span><span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">data</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-44-27" name="__codelineno-44-27"></a><span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Success:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">);</span>
<a id="__codelineno-44-28" name="__codelineno-44-28"></a><span class="w">      </span><span class="nx">getUsers</span><span class="p">();</span>
<a id="__codelineno-44-29" name="__codelineno-44-29"></a><span class="w">    </span><span class="p">})</span>
<a id="__codelineno-44-30" name="__codelineno-44-30"></a><span class="w">    </span><span class="p">.</span><span class="k">catch</span><span class="p">((</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-44-31" name="__codelineno-44-31"></a><span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;Error:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
<a id="__codelineno-44-32" name="__codelineno-44-32"></a><span class="w">    </span><span class="p">});</span>
<a id="__codelineno-44-33" name="__codelineno-44-33"></a><span class="p">}</span>
<a id="__codelineno-44-34" name="__codelineno-44-34"></a>
<a id="__codelineno-44-35" name="__codelineno-44-35"></a><span class="nx">getUsers</span><span class="p">();</span>
<a id="__codelineno-44-36" name="__codelineno-44-36"></a>
<a id="__codelineno-44-37" name="__codelineno-44-37"></a><span class="c1">// obtiene y presenta la lista de usuarios</span>
<a id="__codelineno-44-38" name="__codelineno-44-38"></a><span class="kd">function</span><span class="w"> </span><span class="nx">getUsers</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-44-39" name="__codelineno-44-39"></a><span class="w">  </span><span class="nx">fetch</span><span class="p">(</span><span class="s2">&quot;http://localhost:3000/users&quot;</span><span class="p">)</span>
<a id="__codelineno-44-40" name="__codelineno-44-40"></a><span class="w">    </span><span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">response</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">())</span>
<a id="__codelineno-44-41" name="__codelineno-44-41"></a><span class="w">    </span><span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">data</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-44-42" name="__codelineno-44-42"></a><span class="w">      </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;users&quot;</span><span class="p">).</span><span class="nx">innerHTML</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&lt;h2&gt;Users&lt;/h2&gt;&quot;</span><span class="p">;</span>
<a id="__codelineno-44-43" name="__codelineno-44-43"></a><span class="w">      </span><span class="nx">data</span><span class="p">.</span><span class="nx">reverse</span><span class="p">().</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">user</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-44-44" name="__codelineno-44-44"></a><span class="w">        </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;users&quot;</span><span class="p">).</span><span class="nx">innerHTML</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="sb">`</span>
<a id="__codelineno-44-45" name="__codelineno-44-45"></a><span class="sb">        &lt;div id=&quot;user-</span><span class="si">${</span><span class="nx">user</span><span class="p">.</span><span class="nx">id</span><span class="si">}</span><span class="sb">&quot; class=&quot;user&quot;&gt;</span>
<a id="__codelineno-44-46" name="__codelineno-44-46"></a><span class="sb">        &lt;span&gt;id: </span><span class="si">${</span><span class="nx">user</span><span class="p">.</span><span class="nx">id</span><span class="si">}</span><span class="sb">&lt;/span&gt; -</span>
<a id="__codelineno-44-47" name="__codelineno-44-47"></a><span class="sb">        &lt;span class=&quot;user-name&quot;&gt;name: </span><span class="si">${</span><span class="nx">user</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="sb">&lt;/span&gt; -</span>
<a id="__codelineno-44-48" name="__codelineno-44-48"></a><span class="sb">        &lt;span class=&quot;user-email&quot;&gt;email: </span><span class="si">${</span><span class="nx">user</span><span class="p">.</span><span class="nx">email</span><span class="si">}</span><span class="sb">&lt;/span&gt;</span>
<a id="__codelineno-44-49" name="__codelineno-44-49"></a><span class="sb">      &lt;/div&gt;</span>
<a id="__codelineno-44-50" name="__codelineno-44-50"></a><span class="sb">      &lt;hr&gt;</span>
<a id="__codelineno-44-51" name="__codelineno-44-51"></a><span class="sb">        `</span><span class="p">;</span>
<a id="__codelineno-44-52" name="__codelineno-44-52"></a><span class="w">      </span><span class="p">});</span>
<a id="__codelineno-44-53" name="__codelineno-44-53"></a><span class="w">    </span><span class="p">});</span>
<a id="__codelineno-44-54" name="__codelineno-44-54"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<div class="admonition question">
<p class="admonition-title">ACTIVIDAD 5: <code>📂 UD5/act05/</code></p>
<p>Crear una pequeña aplicación para gestionar una lista de deseos de Navidad, mediante peticiones Ajax a un servidor local <em>json-server</em>.</p>
<ol>
<li><strong>Crea</strong> dos carpetas <em><strong><code>client/</code></strong></em> y <em><strong><code>server/</code></strong></em>.</li>
<li><strong>Dentro de <code>server/</code></strong> realiza los siguientes pasos:<ol>
<li><strong>Crea</strong> un fichero <strong><em><code>datos.json</code></em></strong> con el siguiente contenidos:
<div class="highlight"><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a><span class="p">{</span>
<a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a><span class="w">    </span><span class="nt">&quot;products&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<a id="__codelineno-45-3" name="__codelineno-45-3" href="#__codelineno-45-3"></a><span class="w">        </span><span class="p">{</span>
<a id="__codelineno-45-4" name="__codelineno-45-4" href="#__codelineno-45-4"></a><span class="w">            </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-45-5" name="__codelineno-45-5" href="#__codelineno-45-5"></a><span class="w">            </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Smile&quot;</span><span class="p">,</span>
<a id="__codelineno-45-6" name="__codelineno-45-6" href="#__codelineno-45-6"></a><span class="w">            </span><span class="nt">&quot;price&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.0</span>
<a id="__codelineno-45-7" name="__codelineno-45-7" href="#__codelineno-45-7"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-45-8" name="__codelineno-45-8" href="#__codelineno-45-8"></a><span class="w">    </span><span class="p">]</span>
<a id="__codelineno-45-9" name="__codelineno-45-9" href="#__codelineno-45-9"></a><span class="p">}</span>
</code></pre></div></li>
<li><strong>Instala <em>json-server</em></strong> como dependencia de desarrollo, ejecuta en la consola:
<div class="highlight"><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a>npm<span class="w"> </span>init<span class="w"> </span>-y
<a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a>npm<span class="w"> </span>install<span class="w"> </span>-D<span class="w"> </span>json-server
</code></pre></div></li>
<li><strong>Edita <em><code>package.json</code></em></strong> y añade la siguiente línea en el apartado <strong>"scripts"</strong>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a><span class="nt">&quot;scripts&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a><span class="hll"><span class="w">    </span><span class="nt">&quot;server&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;json-server -d 400 datos.json&quot;</span>
</span><a id="__codelineno-47-3" name="__codelineno-47-3" href="#__codelineno-47-3"></a><span class="p">}</span>
</code></pre></div>
Permitirá poner en marcha el servicio con un pequeño retardo de <em>400ms</em> para simular retraso en la respuesta del servidor.</li>
<li><strong>Inicia el servicio</strong> con:
<div class="highlight"><pre><span></span><code><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a>npm run server
</code></pre></div></li>
</ol>
</li>
<li><strong>Dentro de <code>client/</code></strong> <strong>crea</strong> un fichero <strong><em><code>index.html</code></em></strong> con el siguiente contenido:<ol>
<li>En el <strong>título</strong> de la página: <strong><em><code>Xmas Wishlist</code></em></strong>.</li>
<li>Un <strong>formulario</strong> para <strong>buscar</strong> productos por nombre:<ul>
<li>Un campo de texto para introducir el nombre del producto</li>
<li>Un botón para enviar el formulario</li>
</ul>
</li>
<li>Un <strong>formulario</strong> para <strong>crear nuevos</strong> productos:<ul>
<li>Nombre del producto</li>
<li>Precio</li>
<li>Botón para enviar el formulario</li>
</ul>
</li>
<li>Un <strong>formulario</strong> para <strong>borrar</strong> un producto por su <code>id</code>:<ul>
<li>Un campo de texto para introducir el <code>id</code> del producto</li>
<li>Un botón para enviar el formulario</li>
</ul>
</li>
<li>Un <code>div</code> para mostrar los <strong>resultados</strong> de las peticiones</li>
<li>Un <code>div</code> para mostrar <strong>mensajes de error</strong></li>
<li>Un <code>loader</code> para mostrar mientras se realizan las peticiones, <em>puedes utilizar uno de los que creamos en las actividades anteriores</em>.</li>
</ol>
</li>
<li><strong>Dentro de <code>client/</code></strong> <strong>crea</strong> un fichero <strong><em><code>main.js</code></em></strong> con el siguiente contenido:<ol>
<li>Añade un <em>eventListener</em> al <strong>formulario de búsqueda</strong> para que cuando se envíe haga una <strong>petición <code>GET</code></strong> al servidor con el <strong>nombre del producto a buscar</strong> y muestre los resultados en la página.</li>
<li>Añade un <em>eventListener</em> al <strong>formulario de añadir productos</strong> para que cuando se envíe haga una <strong>petición <code>POST</code></strong> al servidor con los <strong>datos del producto</strong> a añadir y muestre los resultados en la página.</li>
<li>Añade un <em>eventListener</em> al <strong>formulario de borrar</strong> productos para que cuando se envíe haga una <strong>petición <code>DELETE</code></strong> al servidor con el <strong><code>id</code> del producto a borrar</strong> y muestre los resultados en la página.</li>
<li>Crea un <strong>componente <em><code>product-info</code></em></strong> que muestre la información de un producto individual, con su id, nombre y precio. Este componente se usará para mostrar los resultados de las peticiones.</li>
<li>El código de las peticiones debe estar en <strong>funciones independientes</strong>.</li>
<li>Se debe <strong>mostrar un mensaje de error</strong> si la petición no se ha podido realizar y <strong>ocultarlo</strong> si se realiza correctamente.</li>
<li>Se debe <strong>mostrar un <em>loader</em></strong> mientras se realizan las peticiones y <strong>ocultarlo</strong> cuando se han terminado, tanto si se han realizado correctamente como si no.</li>
<li>Se debe <strong>ocultar</strong> el <code>div</code> de <strong>resultados</strong> al realizar cualquier petición.</li>
</ol>
</li>
</ol>
<p><strong>Estructura de carpetas:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a>📂 UD5/
<a id="__codelineno-49-2" name="__codelineno-49-2" href="#__codelineno-49-2"></a>└── 📂 act05/
<a id="__codelineno-49-3" name="__codelineno-49-3" href="#__codelineno-49-3"></a>    ├── 📂 client/
<a id="__codelineno-49-4" name="__codelineno-49-4" href="#__codelineno-49-4"></a>    │   ├── 📄 index.html
<a id="__codelineno-49-5" name="__codelineno-49-5" href="#__codelineno-49-5"></a>    │   ├── 📄 main.js
<a id="__codelineno-49-6" name="__codelineno-49-6" href="#__codelineno-49-6"></a>    │   ├── 📄 ProductInfoComponent.js
<a id="__codelineno-49-7" name="__codelineno-49-7" href="#__codelineno-49-7"></a>    │   └── 📄 RequestLoaderComponent.js
<a id="__codelineno-49-8" name="__codelineno-49-8" href="#__codelineno-49-8"></a>    └── 📂 server/
<a id="__codelineno-49-9" name="__codelineno-49-9" href="#__codelineno-49-9"></a>        ├── 📄 datos.json
<a id="__codelineno-49-10" name="__codelineno-49-10" href="#__codelineno-49-10"></a>        └── 📄 package.json
</code></pre></div></p>
</div>
<h2 id="single-page-application">Single Page Application<a class="headerlink" href="#single-page-application" title="Permanent link">&para;</a></h2>
<p>Ajax es la base para construir SPAs que permiten al usuario interactuar con una aplicación web como si se tratara de una aplicación de escritorio (sin "esperas" que dejen la página en blanco o no funcional mientras se recarga desde el servidor).</p>
<p>En una SPA sólo se carga la página de inicio (es la única página que existe) que se va modificando y cambiando sus datos como respuesta a la interacción del usuario. Para obtener los nuevos datos se realizan peticiones al servidor (normalmente Ajax). La respuesta son datos (JSON, XML, etc.) que se muestran al usuario modificando mediante DOM la página mostrada (o podrían ser trozos de HTML que se cargan en determinadas partes de la página, o ...).</p>
<h2 id="resumen-de-llamadas-asincronas">Resumen de llamadas asíncronas<a class="headerlink" href="#resumen-de-llamadas-asincronas" title="Permanent link">&para;</a></h2>
<p>Una llamada Ajax es un tipo de llamada asíncrona que podemos hacer en Javascript aunque hay muchas más, como un <code>setTimeout()</code> o las funciones manejadoras de eventos. Como hemos visto, para la gestión de las llamadas asíncronas tenemos varios métodos y los más comunes son:</p>
<ul>
<li>funciones <em>callback</em></li>
<li><em>promesas</em></li>
<li><em>async / await</em></li>
</ul>
<p>Cuando se produce una llamada asíncrona el orden de ejecución del código no es el que vemos en el programa ya que el código de respuesta de la llamada no se ejecutará hasta completarse esta. Podemos ver <a href="https://repl.it/DhKt/1">un ejemplo</a> de esto extraído de <strong>todoJS</strong> usando <strong>funciones <em>callback</em></strong>.</p>
<p>Además, si hacemos varias llamadas tampoco sabemos el qué orden se ejecutarán sus respuestas ya que depende de cuándo finalice cada una como podemos ver en <a href="https://repl.it/DhLA/0">este otro ejemplo</a>.</p>
<p>Si usamos funciones <em>callback</em> y necesitamos que cada función no se ejecute hasta que haya terminado la anterior debemos llamarla en la respuesta a la función anterior lo que provoca un tipo de código difícil de leer llamado <a href="https://repl.it/DhLN/0"><em>callback hell</em></a>.</p>
<p>Para evitar esto surgieron las <strong><em>promesas</em></strong> que permiten evitar las funciones <em>callback</em> tan difíciles de leer. Podemos ver <a href="https://repl.it/DhMA/1">el primer ejemplo</a> usando promesas. Y si necesitamos ejecutar secuencialmente las funciones evitaremos la pirámide de llamadas <em>callback</em> como vemos en <a href="https://repl.it/DhMK/0">este ejemplo</a>.</p>
<p>Aún así el código no es muy claro. Para mejorarlo tenemos <strong><em>async</em> y <em>await</em></strong> como vemos en <a href="https://repl.it/DhMa/0">este ejemplo</a>. Estas funciones forman parte del estándar ES2017 por lo que no están soportadas por navegadores muy antiguos (aunque siempre podemos transpilar con <em>Babel</em>).</p>
<p>Fuente: <a href="https://www.todojs.com/controlar-la-ejecucion-asincrona/">todoJs: Controlar la ejecución asíncrona</a></p>
<h2 id="cors">CORS<a class="headerlink" href="#cors" title="Permanent link">&para;</a></h2>
<p><em>Cross-Origin Resource Sharing</em> (CORS) es un mecanismo de seguridad que incluyen los navegadores y que por defecto impiden que se pueden realizar peticiones Ajax desde un navegador a un servidor con un dominio diferente al de la página cargada originalmente. </p>
<p>Si necesitamos hacer este tipo de peticiones necesitamos que el servidor  al que hacemos la petición añada en su respuesta la cabecera <em>Access-Control-Allow-Origin</em> donde indiquemos el dominio desde el que se pueden hacer peticiones (o <strong>*</strong> para permitirlas desde cualquier dominio).</p>
<p>El navegador comprobará las cabeceras de respuesta y si el dominio indicado por ella coincide con el dominio desde el que se hizo la petición, esta se permitirá.</p>
<p>Como en desarrollo normalmente no estamos en el dominio de producción (para el que se permitirán las peticiones) podemos instalar en el navegador la extensión <em>allow CORS</em> que al activarla deshabilita la seguridad CORS en el navegador.</p>
<p>Podéis ampliar la información en numerosas páginas web como <a href="https://www.enmilocalfunciona.io/entendiendo-cors-y-aplicando-soluciones/">"Entendiendo CORS y aplicando soluciones"</a>.</p>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Volver al principio
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/jsanvil/dwec2023" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.sections", "navigation.top", "toc.follow", "search.suggest", "search.highlight", "content.tabs.link", "content.code.annotation", "content.code.copy"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copiado al portapapeles", "clipboard.copy": "Copiar al portapapeles", "search.result.more.one": "1 m\u00e1s en esta p\u00e1gina", "search.result.more.other": "# m\u00e1s en esta p\u00e1gina", "search.result.none": "No se encontraron documentos", "search.result.one": "1 documento encontrado", "search.result.other": "# documentos encontrados", "search.result.placeholder": "Teclee para comenzar b\u00fasqueda", "search.result.term.missing": "Falta", "select.version": "Seleccionar versi\u00f3n"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.8fd75fb4.min.js"></script>
      
    
  </body>
</html>